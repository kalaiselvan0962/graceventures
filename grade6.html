<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Falling Blocks - Python Code</title>
<style>
    body {
        background: #0f0f0f;
        color: #ddd;
        font-family: Consolas, "Courier New", monospace;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        flex-direction: column;
    }
    h1 {
        color: #00ff9d;
        font-weight: 500;
    }
    pre {
        background: #1a1a1a;
        color: #00ff9d;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        max-width: 90%;
        box-shadow: 0 0 20px rgba(0, 255, 150, 0.2);
    }
    button {
        margin-top: 15px;
        padding: 10px 20px;
        background: #00ff9d;
        color: #000;
        border: none;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
    }
    button:hover {
        background: #00cc80;
    }
</style>
</head>
<body>

<h1>ðŸŽ® Falling Blocks (Python + Pygame)</h1>

<pre id="code">


import pygame
import sys
import random
import requests
import json
import time

# ------------------ API CONFIG ------------------
URL = "https://wizklub.com/api/secured/wiziot-poll-request/"
HEADERS = {
    "Api-Access-Key": "USER_ACCESS_API_KEY",
    "Api-Secret-Key": "USER_SECRET_API_KEY",
    "Content-Type": "application/json"
}

PAYLOAD = json.dumps({
    "mode": "READ",
    "device_id": "aws_device_id",
    "source": "API",
    "api": "sensor",
    "sensor": "joystick"
})

# ------------------ GAME SETUP ------------------
pygame.init()

ROWS, COLS = 10, 10
BLOCK_SIZE = 40
TOP_MARGIN = 40
WIDTH, HEIGHT = COLS * BLOCK_SIZE, ROWS * BLOCK_SIZE

screen = pygame.display.set_mode((WIDTH, HEIGHT + TOP_MARGIN))
pygame.display.set_caption("Falling Blocks - IoT Controlled")

clock = pygame.time.Clock()
font = pygame.font.SysFont(None, 28)

BLACK = (0, 0, 0)
GRAY = (50, 50, 50)
RED = (200, 50, 50)
WHITE = (255, 255, 255)

# ------------------ FUNCTIONS ------------------
def draw_grid():
    for r in range(ROWS):
        for c in range(COLS):
            pygame.draw.rect(
                screen,
                GRAY,
                (c * BLOCK_SIZE, r * BLOCK_SIZE + TOP_MARGIN, BLOCK_SIZE, BLOCK_SIZE),
                1
            )

def read_joystick():
    try:
        response = requests.post(URL, headers=HEADERS, data=PAYLOAD, timeout=1)
        data = response.json()

        # Example expected: {"direction": "LEFT"}
        return data.get("direction", None)

    except:
        return None

# ------------------ BLOCK CLASS ------------------
class Block:
    def __init__(self):
        self.col = random.randint(0, COLS - 1)
        self.row = 0
        self.color = RED
        self.speed = 0.4
        self.timer = 0

    def move(self, dx, dy):
        if 0 <= self.col + dx < COLS:
            self.col += dx
        if 0 <= self.row + dy < ROWS:
            self.row += dy

    def update(self, dt):
        self.timer += dt
        if self.timer >= self.speed:
            self.timer = 0
            if self.row < ROWS - 1:
                self.row += 1
            else:
                self.__init__()  # Respawn when bottom

    def draw(self):
        pygame.draw.rect(
            screen,
            self.color,
            (self.col * BLOCK_SIZE, self.row * BLOCK_SIZE + TOP_MARGIN,
             BLOCK_SIZE, BLOCK_SIZE)
        )

# ------------------ GAME LOOP ------------------
block = Block()
last_api_read = 0
API_INTERVAL = 0.3  # seconds

running = True
while running:
    dt = clock.tick(60) / 1000

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # ----- READ JOYSTICK FROM API -----
    if time.time() - last_api_read > API_INTERVAL:
        joystick = read_joystick()
        last_api_read = time.time()

        if joystick == "LEFT":
            block.move(-1, 0)
        elif joystick == "RIGHT":
            block.move(1, 0)
        elif joystick == "DOWN":
            block.move(0, 1)

    # ----- FALLING -----
    block.update(dt)

    # ----- DRAW -----
    screen.fill(BLACK)

    title = font.render("Falling Blocks (IoT Joystick)", True, WHITE)
    screen.blit(title, (10, 8))

    draw_grid()
    block.draw()
    pygame.display.flip()

pygame.quit()
sys.exit()


    
</pre>

<button onclick="copyCode()">ðŸ“‹ Copy Code</button>

<script>
function copyCode() {
    const codeElement = document.getElementById('code');
    navigator.clipboard.writeText(codeElement.innerText).then(() => {
        alert('âœ… Python code copied to clipboard!');
    });
}
</script>

</body>
</html>
