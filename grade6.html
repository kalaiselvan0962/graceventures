import pygame
import sys

# 1. Initialize Pygame
pygame.init()

# 2. Set up game grid values
ROWS, COLS = 10, 10
BLOCK_SIZE = 40  # Each block is 40px wide

# 3. Calculate game window size
WIDTH, HEIGHT = COLS * BLOCK_SIZE, ROWS * BLOCK_SIZE
TOP_MARGIN = 40  # Extra space at the top for score or text

# 4. Create the actual game window
screen = pygame.display.set_mode((WIDTH, HEIGHT + TOP_MARGIN))
pygame.display.set_caption("Falling Blocks")

# 5. Create a clock to control FPS
clock = pygame.time.Clock()

# Colors
BG_COLOR = (0, 0, 0)
GRID_COLOR = (40, 40, 40)
BLOCK_COLOR = (0, 200, 255)

# 6. Define the falling block properties
block_x = COLS // 2  # Start in the middle
block_y = 0          # Start at the top

fall_speed = 0.3  # Falling speed (lower = slower)
fall_counter = 0   # Counter to control fall timing

# 7. Function to draw the grid lines
def draw_grid():
    for row in range(ROWS):
        for col in range(COLS):
            pygame.draw.rect(
                screen,
                GRID_COLOR,
                (col * BLOCK_SIZE, row * BLOCK_SIZE + TOP_MARGIN, BLOCK_SIZE, BLOCK_SIZE),
                1
            )

# 8. Draw the falling block
def draw_block(x, y):
    pygame.draw.rect(
        screen,
        BLOCK_COLOR,
        (x * BLOCK_SIZE, y * BLOCK_SIZE + TOP_MARGIN, BLOCK_SIZE, BLOCK_SIZE)
    )

# 9. Game loop
running = True
while running:
    screen.fill(BG_COLOR)

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Handle keyboard inputs
    keys = pygame.key.get_pressed()
    if keys[pygame.K_LEFT] and block_x > 0:
        block_x -= 1
        pygame.time.delay(100)  # Prevents super-fast movement
    if keys[pygame.K_RIGHT] and block_x < COLS - 1:
        block_x += 1
        pygame.time.delay(100)

    # Control block falling
    fall_counter += fall_speed
    if fall_counter >= 1:
        fall_counter = 0
        if block_y < ROWS - 1:
            block_y += 1  # Block falls
        else:
            # Reset block when it hits bottom
            block_y = 0
            block_x = COLS // 2

    # Draw everything
    draw_grid()
    draw_block(block_x, block_y)

    # Update the display
    pygame.display.update()

    # Control game speed
    clock.tick(60)

# Quit Pygame safely
pygame.quit()
sys.exit()
