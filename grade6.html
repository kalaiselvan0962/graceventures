import pygame
import sys
import random

# 1. Initialize Pygame
pygame.init()

# 2. Game grid setup
ROWS, COLS = 10, 10
BLOCK_SIZE = 40
WIDTH, HEIGHT = COLS * BLOCK_SIZE, ROWS * BLOCK_SIZE
TOP_MARGIN = 40

# 3. Create window
screen = pygame.display.set_mode((WIDTH, HEIGHT + TOP_MARGIN))
pygame.display.set_caption("Falling Blocks")

# 4. Clock for FPS control
clock = pygame.time.Clock()

# 5. Colors
BLACK = (0, 0, 0)
GRAY = (40, 40, 40)
RED = (200, 50, 50)

# 6. Draw grid
def draw_grid():
    for row in range(ROWS):
        for col in range(COLS):
            pygame.draw.rect(
                screen,
                GRAY,
                (col * BLOCK_SIZE, row * BLOCK_SIZE + TOP_MARGIN, BLOCK_SIZE, BLOCK_SIZE),
                1
            )

# 7. Block class
class Block:
    def __init__(self):
        self.col = random.randint(0, COLS - 1)
        self.row = 0
        self.color = RED
        self.speed = 0.3  # Falling speed (lower = slower)
        self.fall_timer = 0

    def move(self, dx, dy):
        new_col = self.col + dx
        new_row = self.row + dy
        if 0 <= new_col < COLS and 0 <= new_row < ROWS:
            self.col = new_col
            self.row = new_row

    def update(self, dt):
        self.fall_timer += dt
        if self.fall_timer >= self.speed:
            self.fall_timer = 0
            if self.row < ROWS - 1:
                self.row += 1  # Move down

    def draw(self):
        pygame.draw.rect(
            screen,
            self.color,
            (self.col * BLOCK_SIZE, self.row * BLOCK_SIZE + TOP_MARGIN, BLOCK_SIZE, BLOCK_SIZE)
        )

# 8. Create a block
block = Block()

# 9. Game loop
running = True
while running:
    dt = clock.tick(60) / 1000  # Delta time in seconds

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Get pressed keys
    keys = pygame.key.get_pressed()
    if keys[pygame.K_LEFT]:
        block.move(-1, 0)
    if keys[pygame.K_RIGHT]:
        block.move(1, 0)
    if keys[pygame.K_DOWN]:
        block.move(0, 1)

    # Update block (falling)
    block.update(dt)

    # Draw everything
    screen.fill(BLACK)
    draw_grid()
    block.draw()
    pygame.display.update()

# Quit safely
pygame.quit()
sys.exit()
