<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pok√©Quest GO</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Orbitron:wght@400;700;900&display=swap');
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
         :root {
            --primary: #e63946;
            --secondary: #1d3557;
            --accent: #ffd60a;
            --teal: #06d6a0;
            --dark: #0d1117;
            --card: rgba(255, 255, 255, 0.07);
            --glass: rgba(13, 17, 23, 0.85);
        }
        
        body {
            background: var(--dark);
            font-family: 'Rajdhani', sans-serif;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            touch-action: none;
        }
        /* ===== MAP SCREEN ===== */
        
        #mapScreen {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        #mapCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        /* ===== TOP HUD ===== */
        
        #topHud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 16px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
            z-index: 10;
        }
        
        .trainer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trainer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid var(--accent);
            background: linear-gradient(135deg, #457b9d, #1d3557);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: 0 0 15px rgba(255, 214, 10, 0.5);
        }
        
        .trainer-details {}
        
        .trainer-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .xp-bar-container {
            width: 120px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
        }
        
        .xp-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--teal), var(--accent));
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .level-badge {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 2px;
        }
        
        .top-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
        }
        
        .pokecoin-display {
            background: var(--glass);
            border: 1px solid rgba(255, 214, 10, 0.4);
            border-radius: 20px;
            padding: 4px 12px;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .stardust-display {
            background: var(--glass);
            border: 1px solid rgba(200, 150, 255, 0.4);
            border-radius: 20px;
            padding: 4px 12px;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: #c8a5ff;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        /* ===== BOTTOM HUD ===== */
        
        #bottomHud {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0 20px 20px;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.9) 0%, transparent 100%);
            z-index: 10;
        }
        
        .bottom-nav {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        .nav-btn {
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 12px 18px;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 70px;
        }
        
        .nav-btn:hover,
        .nav-btn.active {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 214, 10, 0.2);
        }
        
        .nav-btn .icon {
            font-size: 22px;
        }
        
        .pokeball-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #fff 0%, #f00 50%, #700 100%);
            border: 4px solid #fff;
            cursor: pointer;
            position: relative;
            box-shadow: 0 0 30px rgba(230, 57, 70, 0.6), 0 8px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .pokeball-btn::after {
            content: '';
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            border: 3px solid #333;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .pokeball-btn::before {
            content: '';
            position: absolute;
            left: -4px;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            height: 3px;
            background: #333;
        }
        
        .pokeball-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(230, 57, 70, 0.8), 0 12px 30px rgba(0, 0, 0, 0.5);
        }
        /* ===== NEARBY POKEMON LIST ===== */
        
        #nearbyPanel {
            position: absolute;
            bottom: 120px;
            right: 16px;
            width: 140px;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 10px;
            backdrop-filter: blur(15px);
            z-index: 10;
        }
        
        .nearby-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 9px;
            color: var(--teal);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .nearby-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
        }
        
        .nearby-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 5px;
            text-align: center;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }
        
        .nearby-item:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        /* ===== ENCOUNTER SCREEN ===== */
        
        #encounterScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: linear-gradient(180deg, #87ceeb 0%, #90EE90 60%, #5a8a5a 100%);
            overflow: hidden;
        }
        
        #encounterCanvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
        }
        
        .encounter-ui {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }
        
        .pokemon-encounter-info {
            background: var(--glass);
            border-radius: 20px;
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .poke-name-enc {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        .poke-cp {
            background: rgba(255, 214, 10, 0.2);
            border: 1px solid var(--accent);
            border-radius: 12px;
            padding: 4px 12px;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--accent);
        }
        
        .catch-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .pokemon-3d-display {
            text-align: center;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            position: relative;
            z-index: 5;
        }
        
        @keyframes float {
            0%,
            100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-15px);
            }
        }
        
        .pokemon-sprite-large {
            font-size: 120px;
            display: block;
            filter: drop-shadow(0 20px 30px rgba(0, 0, 0, 0.4));
        }
        
        .catch-ring {
            position: absolute;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.5);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .catch-ring-inner {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid rgba(100, 255, 100, 0.7);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: ringPulse 1.5s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes ringPulse {
            0% {
                width: 180px;
                height: 180px;
                opacity: 1;
            }
            100% {
                width: 80px;
                height: 80px;
                opacity: 0.3;
            }
        }
        
        .encounter-bottom {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .ball-selector {
            display: flex;
            gap: 12px;
            justify-content: center;
        }
        
        .ball-option {
            background: var(--glass);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 55px;
            height: 55px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .ball-option.selected {
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(255, 214, 10, 0.5);
        }
        
        .ball-option:hover {
            transform: scale(1.1);
        }
        
        .ball-count {
            position: absolute;
            bottom: -8px;
            right: -4px;
            background: var(--primary);
            color: #fff;
            font-size: 9px;
            font-weight: 700;
            padding: 1px 5px;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
        }
        
        .throw-btn {
            background: linear-gradient(135deg, var(--primary), #c1121f);
            border: none;
            border-radius: 30px;
            padding: 16px;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            letter-spacing: 2px;
            text-transform: uppercase;
            box-shadow: 0 8px 25px rgba(230, 57, 70, 0.5);
            transition: all 0.2s;
        }
        
        .throw-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(230, 57, 70, 0.7);
        }
        
        .escape-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 10px;
            color: rgba(255, 255, 255, 0.7);
            font-family: 'Rajdhani', sans-serif;
            font-size: 13px;
            cursor: pointer;
            letter-spacing: 1px;
        }
        /* ===== CATCH ANIMATION ===== */
        
        .catch-ball-anim {
            position: fixed;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #fff 0%, #f00 50%, #700 100%);
            border: 2px solid #fff;
            z-index: 200;
            pointer-events: none;
            display: none;
        }
        
        .catch-result-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
            flex-direction: column;
            gap: 20px;
        }
        
        .result-emoji {
            font-size: 80px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .result-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            text-align: center;
        }
        
        .result-text.success {
            color: var(--teal);
        }
        
        .result-text.fail {
            color: var(--primary);
        }
        
        .result-xp {
            color: var(--accent);
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
        }
        
        @keyframes popIn {
            0% {
                transform: scale(0) rotate(-20deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
            }
        }
        /* ===== POKEDEX SCREEN ===== */
        
        #pokedexScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 90;
            background: linear-gradient(135deg, #0d1117, #1a1a2e);
            overflow-y: auto;
        }
        
        .screen-header {
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--glass);
            backdrop-filter: blur(15px);
            position: sticky;
            top: 0;
            z-index: 5;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .screen-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: 900;
            color: var(--accent);
        }
        
        .pokedex-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            padding: 16px;
        }
        
        .pokedex-entry {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .pokedex-entry:hover {
            transform: translateY(-4px);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .pokedex-entry.unseen {
            filter: brightness(0.3);
        }
        
        .pokedex-entry.seen {
            filter: brightness(0.6) grayscale(0.8);
        }
        
        .pokedex-entry.caught {}
        
        .poke-icon {
            font-size: 36px;
        }
        
        .poke-num {
            font-family: 'Orbitron', sans-serif;
            font-size: 8px;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 4px;
        }
        
        .poke-dex-name {
            font-size: 10px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .caught-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 10px;
        }
        /* ===== POKEMON DETAIL ===== */
        
        #pokemonDetail {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 110;
            overflow-y: auto;
        }
        
        .detail-bg {
            min-height: 100%;
            padding-bottom: 30px;
        }
        
        .detail-hero {
            padding: 60px 20px 30px;
            text-align: center;
            position: relative;
        }
        
        .detail-pokemon-icon {
            font-size: 100px;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.5));
        }
        
        .detail-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            margin-top: 10px;
        }
        
        .type-badges {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .type-badge {
            padding: 4px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .detail-stats {
            background: var(--card);
            margin: 0 16px;
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .stat-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .stat-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            width: 40px;
            text-transform: uppercase;
        }
        
        .stat-bar-bg {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .stat-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }
        
        .stat-val {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            color: #fff;
            width: 30px;
            text-align: right;
        }
        /* ===== INVENTORY SCREEN ===== */
        
        #inventoryScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 90;
            background: linear-gradient(135deg, #0d1117, #1a1a2e);
            overflow-y: auto;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            padding: 16px;
        }
        
        .inv-item {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .inv-item:hover {
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .inv-icon {
            font-size: 36px;
        }
        
        .inv-name {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
            font-weight: 600;
        }
        
        .inv-count {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--accent);
            margin-top: 4px;
        }
        /* ===== MY POKEMON ===== */
        
        #myPokemonScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 90;
            background: linear-gradient(135deg, #0d1117, #1a1a2e);
            overflow-y: auto;
        }
        
        .my-pokemon-list {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .my-poke-card {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .my-poke-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .my-poke-icon {
            font-size: 50px;
        }
        
        .my-poke-info {
            flex: 1;
        }
        
        .my-poke-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 15px;
            font-weight: 700;
        }
        
        .my-poke-cp {
            color: var(--accent);
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            margin-top: 2px;
        }
        
        .my-poke-hp {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 3px;
        }
        
        .my-poke-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 20px;
        }
        /* ===== POKESTOP ===== */
        
        .pokestop-indicator {
            position: absolute;
            cursor: pointer;
            z-index: 8;
            text-align: center;
            pointer-events: all;
        }
        
        .pokestop-cube {
            width: 30px;
            height: 30px;
            font-size: 20px;
            animation: cubeFloat 3s ease-in-out infinite, cubeSpin 6s linear infinite;
            filter: drop-shadow(0 0 10px rgba(6, 214, 160, 0.8));
        }
        
        @keyframes cubeFloat {
            0%,
            100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-8px);
            }
        }
        
        @keyframes cubeSpin {
            0% {
                filter: drop-shadow(0 0 10px rgba(6, 214, 160, 0.8)) hue-rotate(0deg);
            }
            100% {
                filter: drop-shadow(0 0 10px rgba(6, 214, 160, 0.8)) hue-rotate(360deg);
            }
        }
        /* ===== GYMS ===== */
        
        .gym-indicator {
            position: absolute;
            cursor: pointer;
            z-index: 8;
            text-align: center;
        }
        
        .gym-tower {
            font-size: 28px;
            animation: gymGlow 2s ease-in-out infinite;
            filter: drop-shadow(0 0 12px rgba(255, 214, 10, 0.8));
        }
        
        @keyframes gymGlow {
            0%,
            100% {
                filter: drop-shadow(0 0 12px rgba(255, 214, 10, 0.8));
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(230, 57, 70, 0.9));
            }
        }
        /* ===== SPAWN MARKERS ===== */
        
        .spawn-marker {
            position: absolute;
            z-index: 7;
            cursor: pointer;
            text-align: center;
            animation: spawnBounce 1s ease-in-out infinite alternate;
            pointer-events: all;
        }
        
        @keyframes spawnBounce {
            0% {
                transform: translateY(0) scale(1);
            }
            100% {
                transform: translateY(-5px) scale(1.05);
            }
        }
        
        .spawn-icon {
            font-size: 32px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }
        
        .spawn-shadow {
            width: 25px;
            height: 6px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            margin: 2px auto 0;
            filter: blur(2px);
        }
        /* ===== COMPASS ===== */
        
        .compass {
            position: absolute;
            top: 90px;
            right: 16px;
            width: 45px;
            height: 45px;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            backdrop-filter: blur(10px);
            z-index: 10;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .compass:hover {
            transform: scale(1.1);
        }
        /* ===== WEATHER WIDGET ===== */
        
        .weather-widget {
            position: absolute;
            top: 90px;
            left: 16px;
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 14px;
            padding: 8px 14px;
            backdrop-filter: blur(10px);
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .weather-icon {
            font-size: 20px;
        }
        
        .weather-text {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }
        /* ===== NOTIFICATION ===== */
        
        .notification {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 10px 20px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            font-weight: 600;
            z-index: 500;
            opacity: 0;
            transition: all 0.3s;
            backdrop-filter: blur(15px);
            white-space: nowrap;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        /* ===== POKESTOP SPIN ANIM ===== */
        
        .pokestop-spin-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(6, 214, 160, 0.15);
            z-index: 200;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 15px;
        }
        
        .spin-disk {
            width: 200px;
            height: 200px;
            border: 4px solid var(--teal);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            animation: spinDisk 1s linear infinite;
            box-shadow: 0 0 40px rgba(6, 214, 160, 0.5);
        }
        
        @keyframes spinDisk {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .spin-items {
            display: flex;
            gap: 15px;
            font-size: 30px;
        }
        
        .spin-result-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            color: var(--teal);
            letter-spacing: 2px;
        }
        /* ===== LOADING ===== */
        
        #loadingScreen {
            position: fixed;
            inset: 0;
            background: #0d1117;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .loading-ball {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #fff 0%, #f00 50%, #700 100%);
            border: 4px solid #fff;
            animation: loadBounce 1s ease-in-out infinite alternate;
            box-shadow: 0 0 30px rgba(230, 57, 70, 0.6);
            position: relative;
        }
        
        .loading-ball::before {
            content: '';
            position: absolute;
            left: -4px;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            height: 3px;
            background: #333;
        }
        
        .loading-ball::after {
            content: '';
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            border: 3px solid #333;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes loadBounce {
            0% {
                transform: translateY(-30px) scale(1);
            }
            100% {
                transform: translateY(30px) scale(0.9);
            }
        }
        
        .loading-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            color: var(--accent);
            letter-spacing: 3px;
        }
        
        .loading-bar-bg {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 2px;
            animation: loadBar 2s ease forwards;
        }
        
        @keyframes loadBar {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }
        /* ===== SHAKE ANIM ===== */
        
        @keyframes shakeBall {
            0%,
            100% {
                transform: translateX(0) rotate(0deg);
            }
            10%,
            30%,
            50%,
            70% {
                transform: translateX(-5px) rotate(-5deg);
            }
            20%,
            40%,
            60%,
            80% {
                transform: translateX(5px) rotate(5deg);
            }
            90% {
                transform: translateX(0) rotate(0deg);
            }
        }
        
        .shaking {
            animation: shakeBall 0.8s ease !important;
        }
        /* ===== PLAYER AVATAR ON MAP ===== */
        
        #playerMarker {
            position: absolute;
            z-index: 9;
            pointer-events: none;
            text-align: center;
            transition: left 0.5s ease, top 0.5s ease;
        }
        
        .player-arrow {
            font-size: 32px;
            filter: drop-shadow(0 0 8px rgba(255, 214, 10, 0.9));
            animation: playerPulse 2s ease-in-out infinite;
        }
        
        @keyframes playerPulse {
            0%,
            100% {
                filter: drop-shadow(0 0 8px rgba(255, 214, 10, 0.9));
            }
            50% {
                filter: drop-shadow(0 0 18px rgba(255, 214, 10, 1)) drop-shadow(0 0 25px rgba(255, 214, 10, 0.5));
            }
        }
        
        .player-range {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 1px solid rgba(255, 214, 10, 0.3);
            background: rgba(255, 214, 10, 0.05);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        /* ===== TABS ===== */
        
        .filter-tabs {
            display: flex;
            gap: 8px;
            padding: 0 16px 12px;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .filter-tab {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 6px 16px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .filter-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }
        /* ===== RADAR ===== */
        
        .radar-widget {
            position: absolute;
            bottom: 125px;
            left: 16px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid rgba(6, 214, 160, 0.5);
            background: rgba(6, 214, 160, 0.05);
            backdrop-filter: blur(10px);
            overflow: hidden;
            z-index: 10;
        }
        
        .radar-sweep {
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(transparent 0deg, rgba(6, 214, 160, 0.3) 90deg, transparent 90deg);
            animation: radarSweep 3s linear infinite;
            transform-origin: center;
        }
        
        @keyframes radarSweep {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .radar-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--teal);
            border-radius: 50%;
            animation: radarBlink 1s ease-in-out infinite;
        }
        
        @keyframes radarBlink {
            0%,
            100% {
                opacity: 1;
            }
            50% {
                opacity: 0.3;
            }
        }
        
        .radar-cross {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .radar-cross::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 1px;
            background: rgba(6, 214, 160, 0.3);
        }
        
        .radar-cross::after {
            content: '';
            position: absolute;
            width: 1px;
            height: 100%;
            background: rgba(6, 214, 160, 0.3);
        }
        /* ===== POKEBALLS SHAKE COUNTER ===== */
        
        .catch-feedback {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--accent);
            display: none;
            z-index: 10;
        }
        /* ULTRA BALL STYLE */
        
        .ball-option[data-ball="ultra"] .ball-emoji {
            color: #ffd700;
        }
        /* Gym Battle section */
        
        #gymBattleScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: linear-gradient(135deg, #0d1117, #1a1a2e);
            overflow: hidden;
            flex-direction: column;
        }
        
        .battle-arena {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
        }
        
        .battle-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            font-weight: 900;
            color: var(--primary);
            text-align: center;
            padding: 15px;
        }
        
        .hp-bar-section {
            margin-bottom: 5px;
        }
        
        .hp-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .hp-bar-outer {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .hp-bar-inner {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .hp-bar-enemy {
            background: linear-gradient(90deg, #06d6a0, #1dd3b0);
        }
        
        .hp-bar-mine {
            background: linear-gradient(90deg, #e63946, #ff6b6b);
        }
        
        .battle-pokemon-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 10px;
        }
        
        .battle-pokemon {
            text-align: center;
        }
        
        .battle-pokemon-icon {
            font-size: 70px;
        }
        
        .battle-pokemon-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .vs-text {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 900;
            color: var(--primary);
        }
        
        .battle-moves {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .move-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 12px;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        
        .move-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.02);
        }
        
        .move-power {
            font-family: 'Orbitron', sans-serif;
            font-size: 10px;
            color: var(--accent);
            margin-top: 3px;
        }
        /* ===== PROFILE ===== */
        
        #profileScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 90;
            background: linear-gradient(135deg, #0d1117, #1a1a2e);
            overflow-y: auto;
        }
        
        .profile-hero {
            padding: 40px 20px;
            text-align: center;
            background: linear-gradient(180deg, rgba(230, 57, 70, 0.2), transparent);
        }
        
        .profile-avatar-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid var(--accent);
            background: linear-gradient(135deg, #457b9d, #1d3557);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin: 0 auto 15px;
            box-shadow: 0 0 30px rgba(255, 214, 10, 0.4);
        }
        
        .profile-trainer-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 900;
            color: var(--accent);
        }
        
        .profile-level {
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .profile-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 16px;
        }
        
        .profile-stat-card {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 15px 10px;
            text-align: center;
        }
        
        .profile-stat-val {
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .profile-stat-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .medals-section {
            padding: 0 16px;
        }
        
        .medals-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 13px;
            color: var(--accent);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .medals-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .medal-item {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 12px 6px;
            text-align: center;
        }
        
        .medal-icon {
            font-size: 26px;
        }
        
        .medal-name {
            font-size: 9px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 4px;
            text-transform: uppercase;
        }
        /* ===== SCROLL ===== */
        
         ::-webkit-scrollbar {
            width: 4px;
        }
        
         ::-webkit-scrollbar-track {
            background: transparent;
        }
        
         ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 2px;
        }
        /* ===== TEAM SELECT ===== */
        
        #teamSelectScreen {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 150;
            background: rgba(0, 0, 0, 0.95);
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 25px;
            text-align: center;
            padding: 30px;
        }
        
        .team-select-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 900;
            color: #fff;
        }
        
        .team-cards {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .team-card {
            width: 100px;
            padding: 20px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .team-card:hover {
            transform: scale(1.05);
        }
        
        .team-card.team-valor {
            background: rgba(230, 57, 70, 0.2);
            border-color: var(--primary);
        }
        
        .team-card.team-mystic {
            background: rgba(29, 53, 87, 0.4);
            border-color: #4ecdc4;
        }
        
        .team-card.team-instinct {
            background: rgba(255, 214, 10, 0.2);
            border-color: var(--accent);
        }
        
        .team-icon {
            font-size: 40px;
        }
        
        .team-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            margin-top: 8px;
            font-weight: 700;
        }
        
        .team-valor .team-name {
            color: var(--primary);
        }
        
        .team-mystic .team-name {
            color: #4ecdc4;
        }
        
        .team-instinct .team-name {
            color: var(--accent);
        }
        
        .player-range-ring {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 1.5px dashed rgba(255, 214, 10, 0.4);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>

<body>

    <!-- Loading -->
    <div id="loadingScreen">
        <div class="loading-ball"></div>
        <div class="loading-title">Pok√©Quest GO</div>
        <div class="loading-bar-bg">
            <div class="loading-bar-fill"></div>
        </div>
        <div style="color: rgba(255,255,255,0.4); font-size: 12px; font-family: 'Orbitron'; letter-spacing: 2px;">LOADING WORLD...</div>
    </div>

    <!-- Team Select -->
    <div id="teamSelectScreen">
        <div class="team-select-title">üèÜ CHOOSE YOUR TEAM</div>
        <p style="color: rgba(255,255,255,0.5); font-size: 13px;">Your team reflects your battling spirit</p>
        <div class="team-cards">
            <div class="team-card team-valor" onclick="selectTeam('Valor','üî¥')">
                <div class="team-icon">üî•</div>
                <div class="team-name">VALOR</div>
            </div>
            <div class="team-card team-mystic" onclick="selectTeam('Mystic','üîµ')">
                <div class="team-icon">‚ùÑÔ∏è</div>
                <div class="team-name">MYSTIC</div>
            </div>
            <div class="team-card team-instinct" onclick="selectTeam('Instinct','üü°')">
                <div class="team-icon">‚ö°</div>
                <div class="team-name">INSTINCT</div>
            </div>
        </div>
    </div>

    <!-- MAP SCREEN -->
    <div id="mapScreen">
        <canvas id="mapCanvas"></canvas>

        <!-- Player Marker -->
        <div id="playerMarker">
            <div class="player-range-ring"></div>
            <div class="player-arrow">üß≠</div>
        </div>

        <!-- Spawn markers container -->
        <div id="spawnsContainer"></div>
        <!-- PokeStops container -->
        <div id="pokestopsContainer"></div>
        <!-- Gyms container -->
        <div id="gymsContainer"></div>

        <!-- Top HUD -->
        <div id="topHud">
            <div class="trainer-info">
                <div class="trainer-avatar">üß¢</div>
                <div class="trainer-details">
                    <div class="trainer-name" id="trainerNameDisplay">TRAINER</div>
                    <div class="xp-bar-container">
                        <div class="xp-bar" id="xpBar" style="width:15%"></div>
                    </div>
                    <div class="level-badge" id="levelDisplay">LVL 1 ‚Ä¢ 150/1000 XP</div>
                </div>
            </div>
            <div class="top-right">
                <div class="pokecoin-display">ü™ô <span id="coinDisplay">500</span></div>
                <div class="stardust-display">‚≠ê <span id="stardustDisplay">3500</span></div>
            </div>
        </div>

        <!-- Weather & Compass -->
        <div class="weather-widget">
            <span class="weather-icon" id="weatherIcon">‚òÄÔ∏è</span>
            <span class="weather-text" id="weatherText">Clear</span>
        </div>
        <div class="compass">üß≠</div>

        <!-- Radar -->
        <div class="radar-widget">
            <div class="radar-cross"></div>
            <div class="radar-sweep"></div>
            <div class="radar-dot" id="radarDot1" style="top:30%;left:60%"></div>
            <div class="radar-dot" id="radarDot2" style="top:65%;left:25%"></div>
            <div class="radar-dot" id="radarDot3" style="top:50%;left:70%"></div>
        </div>

        <!-- Nearby Panel -->
        <div id="nearbyPanel">
            <div class="nearby-title">NEARBY</div>
            <div class="nearby-grid" id="nearbyGrid"></div>
        </div>

        <!-- Bottom HUD -->
        <div id="bottomHud">
            <div class="bottom-nav">
                <button class="nav-btn" onclick="showPokedex()">
        <span class="icon">üìñ</span>
        <span>Pok√©dex</span>
      </button>
                <button class="nav-btn" onclick="showMyPokemon()">
        <span class="icon">‚ö°</span>
        <span>Pok√©mon</span>
      </button>
                <div style="display:flex;flex-direction:column;align-items:center;gap:5px">
                    <div class="pokeball-btn" onclick="showInventory()"></div>
                    <span style="font-size:10px;color:rgba(255,255,255,0.5);letter-spacing:1px;font-family:'Orbitron'">ITEMS</span>
                </div>
                <button class="nav-btn" onclick="showProfile()">
        <span class="icon">üèÖ</span>
        <span>Profile</span>
      </button>
                <button class="nav-btn" onclick="showShop()">
        <span class="icon">üè™</span>
        <span>Shop</span>
      </button>
            </div>
        </div>
    </div>

    <!-- ENCOUNTER SCREEN -->
    <div id="encounterScreen">
        <canvas id="encounterCanvas"></canvas>
        <div class="encounter-ui">
            <div class="pokemon-encounter-info">
                <div>
                    <div class="poke-name-enc" id="encName">Pikachu</div>
                    <div style="color:rgba(255,255,255,0.6);font-size:12px;margin-top:3px" id="encType">‚ö° Electric</div>
                </div>
                <div class="poke-cp" id="encCp">CP 450</div>
            </div>

            <div class="catch-area">
                <div class="catch-ring"></div>
                <div class="catch-ring-inner" id="catchRingInner"></div>
                <div class="pokemon-3d-display" id="pokemonDisplay" onclick="throwBall()">
                    <span class="pokemon-sprite-large" id="encSprite">‚ö°</span>
                    <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-top:5px;font-family:'Orbitron'">TAP TO THROW</div>
                </div>
            </div>

            <div class="encounter-bottom">
                <div class="ball-selector">
                    <div class="ball-option selected" data-ball="poke" onclick="selectBall('poke',this)">
                        <span style="font-size:22px">üî¥</span>
                        <span class="ball-count" id="pokeballCount">15</span>
                    </div>
                    <div class="ball-option" data-ball="great" onclick="selectBall('great',this)">
                        <span style="font-size:22px">üîµ</span>
                        <span class="ball-count" id="greatballCount">8</span>
                    </div>
                    <div class="ball-option" data-ball="ultra" onclick="selectBall('ultra',this)">
                        <span style="font-size:22px">üü°</span>
                        <span class="ball-count" id="ultraballCount">3</span>
                    </div>
                    <div class="ball-option" data-ball="berry" onclick="useRazzBerry()">
                        <span style="font-size:22px">üçì</span>
                        <span class="ball-count" id="berryCount">5</span>
                    </div>
                </div>
                <button class="throw-btn" onclick="throwBall()">‚¨ÜÔ∏è THROW BALL</button>
                <button class="escape-btn" onclick="escapeEncounter()">RUN AWAY</button>
            </div>
        </div>
    </div>

    <!-- CATCH RESULT -->
    <div class="catch-result-overlay" id="catchResult">
        <div class="result-emoji" id="resultEmoji">üéâ</div>
        <div class="result-text" id="resultText">Gotcha!</div>
        <div class="result-xp" id="resultXp">+100 XP ¬∑ +500 Stardust</div>
        <button onclick="closeCatchResult()" style="margin-top:20px;padding:12px 30px;background:var(--teal);border:none;border-radius:20px;color:#000;font-family:'Orbitron';font-size:13px;font-weight:700;cursor:pointer;letter-spacing:2px">CONTINUE</button>
    </div>

    <!-- POKESTOP SPIN -->
    <div class="pokestop-spin-overlay" id="pokestopSpin">
        <div class="spin-disk">üîµ</div>
        <div class="spin-result-text" id="spinResultText">SPINNING...</div>
        <div class="spin-items" id="spinItems"></div>
        <button onclick="closePokestop()" id="pokestopCloseBtn" style="display:none;margin-top:10px;padding:12px 30px;background:var(--teal);border:none;border-radius:20px;color:#000;font-family:'Orbitron';font-size:13px;font-weight:700;cursor:pointer">COLLECT!</button>
    </div>

    <!-- POKEDEX SCREEN -->
    <div id="pokedexScreen">
        <div class="screen-header">
            <button class="back-btn" onclick="closeScreen('pokedexScreen')">‚Üê</button>
            <div class="screen-title">POK√âDEX</div>
            <div style="margin-left:auto;font-family:'Orbitron';font-size:11px;color:rgba(255,255,255,0.5)" id="dexCount">0 / 18 Caught</div>
        </div>
        <div class="filter-tabs">
            <div class="filter-tab active" onclick="filterDex('all',this)">All</div>
            <div class="filter-tab" onclick="filterDex('caught',this)">Caught</div>
            <div class="filter-tab" onclick="filterDex('seen',this)">Seen</div>
            <div class="filter-tab" onclick="filterDex('unseen',this)">Not Seen</div>
        </div>
        <div class="pokedex-grid" id="pokedexGrid"></div>
    </div>

    <!-- MY POKEMON -->
    <div id="myPokemonScreen">
        <div class="screen-header">
            <button class="back-btn" onclick="closeScreen('myPokemonScreen')">‚Üê</button>
            <div class="screen-title">MY POK√âMON</div>
            <div style="margin-left:auto;font-family:'Orbitron';font-size:11px;color:rgba(255,255,255,0.5)" id="pokemonCount">0 Pokemon</div>
        </div>
        <div class="filter-tabs">
            <div class="filter-tab active">All</div>
            <div class="filter-tab">Favorites</div>
            <div class="filter-tab">Sort: CP</div>
        </div>
        <div class="my-pokemon-list" id="myPokemonList"></div>
    </div>

    <!-- POKEMON DETAIL -->
    <div id="pokemonDetail">
        <div class="detail-bg" id="detailBg">
            <div style="position:sticky;top:0;z-index:5;padding:15px 20px;background:rgba(0,0,0,0.5);backdrop-filter:blur(10px);display:flex;align-items:center;gap:15px">
                <button class="back-btn" onclick="closeScreen('pokemonDetail')">‚Üê</button>
                <span style="font-family:'Orbitron';font-size:14px;color:rgba(255,255,255,0.7)" id="detailNum">#001</span>
            </div>
            <div class="detail-hero">
                <div class="detail-pokemon-icon" id="detailIcon">üê≤</div>
                <div class="detail-name" id="detailName">Dragonite</div>
                <div class="type-badges" id="detailTypes"></div>
            </div>
            <div class="detail-stats">
                <div class="stat-row">
                    <div class="stat-label">HP</div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill hp-bar-mine" id="statHp" style="width:0%"></div>
                    </div>
                    <div class="stat-val" id="statHpVal">0</div>
                </div>
                <div class="stat-row">
                    <div class="stat-label">ATK</div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill" style="background:linear-gradient(90deg,#ff6b6b,#ee5a24)" id="statAtk" style="width:0%"></div>
                    </div>
                    <div class="stat-val" id="statAtkVal">0</div>
                </div>
                <div class="stat-row">
                    <div class="stat-label">DEF</div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill" style="background:linear-gradient(90deg,#74b9ff,#0984e3)" id="statDef" style="width:0%"></div>
                    </div>
                    <div class="stat-val" id="statDefVal">0</div>
                </div>
                <div class="stat-row">
                    <div class="stat-label">SPD</div>
                    <div class="stat-bar-bg">
                        <div class="stat-bar-fill" style="background:linear-gradient(90deg,#55efc4,#00b894)" id="statSpd" style="width:0%"></div>
                    </div>
                    <div class="stat-val" id="statSpdVal">0</div>
                </div>
            </div>
            <div style="padding:16px;display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:5px">
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:12px;text-align:center">
                    <div style="font-family:'Orbitron';font-size:18px;color:var(--accent)" id="detailCp">CP 0</div>
                    <div style="font-size:10px;color:rgba(255,255,255,0.4);margin-top:3px;text-transform:uppercase;letter-spacing:1px">Combat Power</div>
                </div>
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:12px;text-align:center">
                    <div style="font-family:'Orbitron';font-size:18px;color:var(--teal)" id="detailCount">x0</div>
                    <div style="font-size:10px;color:rgba(255,255,255,0.4);margin-top:3px;text-transform:uppercase;letter-spacing:1px">Caught</div>
                </div>
            </div>
            <div style="padding:0 16px 16px">
                <div style="background:rgba(255,255,255,0.05);border-radius:12px;padding:12px">
                    <div style="font-family:'Orbitron';font-size:10px;color:rgba(255,255,255,0.4);margin-bottom:5px;text-transform:uppercase;letter-spacing:1px">Description</div>
                    <div style="font-size:13px;color:rgba(255,255,255,0.7);line-height:1.5" id="detailDesc">Loading...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- INVENTORY -->
    <div id="inventoryScreen">
        <div class="screen-header">
            <button class="back-btn" onclick="closeScreen('inventoryScreen')">‚Üê</button>
            <div class="screen-title">ITEMS</div>
        </div>
        <div class="inventory-grid" id="inventoryGrid"></div>
    </div>

    <!-- PROFILE -->
    <div id="profileScreen">
        <div class="screen-header">
            <button class="back-btn" onclick="closeScreen('profileScreen')">‚Üê</button>
            <div class="screen-title">TRAINER</div>
        </div>
        <div class="profile-hero">
            <div class="profile-avatar-large">üß¢</div>
            <div class="profile-trainer-name" id="profileName">TRAINER RED</div>
            <div class="profile-level" id="profileLevel">Level 1 Trainer</div>
            <div style="margin-top:10px;color:var(--accent);font-size:13px" id="profileTeam">Team: -</div>
        </div>
        <div class="profile-stats-grid">
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statCaught">0</div>
                <div class="profile-stat-label">Caught</div>
            </div>
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statSeen">0</div>
                <div class="profile-stat-label">Seen</div>
            </div>
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statKm">0 km</div>
                <div class="profile-stat-label">Walked</div>
            </div>
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statBattles">0</div>
                <div class="profile-stat-label">Battles</div>
            </div>
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statWins">0</div>
                <div class="profile-stat-label">Wins</div>
            </div>
            <div class="profile-stat-card">
                <div class="profile-stat-val" id="statEggs">0</div>
                <div class="profile-stat-label">Eggs</div>
            </div>
        </div>
        <div class="medals-section">
            <div class="medals-title">üèÖ Medals</div>
            <div class="medals-grid" id="medalsGrid"></div>
        </div>
    </div>

    <!-- GYM BATTLE -->
    <div id="gymBattleScreen" style="display:none">
        <div style="display:none" id="gymBattleInner">
            <div class="screen-header">
                <button class="back-btn" onclick="closeGymBattle()">‚Üê</button>
                <div class="battle-header">GYM BATTLE</div>
            </div>
            <div class="battle-arena">
                <div class="hp-bar-section">
                    <div class="hp-label">ENEMY HP</div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner hp-bar-enemy" id="enemyHpBar" style="width:100%"></div>
                    </div>
                </div>
                <div class="battle-pokemon-display">
                    <div class="battle-pokemon">
                        <div class="battle-pokemon-icon" id="myBattlePoke">‚ö°</div>
                        <div class="battle-pokemon-name" id="myBattleName">Your Pok√©mon</div>
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="battle-pokemon" style="text-align:right">
                        <div class="battle-pokemon-icon" id="enemyBattlePoke">üî•</div>
                        <div class="battle-pokemon-name" id="enemyBattleName">Enemy</div>
                    </div>
                </div>
                <div class="hp-bar-section">
                    <div class="hp-label">YOUR HP</div>
                    <div class="hp-bar-outer">
                        <div class="hp-bar-inner hp-bar-mine" id="myHpBar" style="width:100%"></div>
                    </div>
                </div>
                <div class="battle-moves" id="battleMoves"></div>
                <div id="battleLog" style="background:rgba(0,0,0,0.3);border-radius:10px;padding:10px;font-size:12px;color:rgba(255,255,255,0.7);min-height:50px;font-family:'Rajdhani';line-height:1.4"></div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification"></div>

    <!-- CATCH BALL ANIMATION -->
    <div class="catch-ball-anim" id="catchBall"></div>

    <script>
        // ===== GAME DATA =====
        const POKEMON_DATA = [{
            id: 1,
            name: 'Bulbasaur',
            icon: 'üå±',
            types: ['Grass', 'Poison'],
            color: '#78C850',
            hp: 45,
            atk: 49,
            def: 49,
            spd: 45,
            desc: 'A strange seed was planted on its back at birth. The plant sprouts and grows with this Pok√©mon.'
        }, {
            id: 4,
            name: 'Charmander',
            icon: 'üî•',
            types: ['Fire'],
            color: '#F08030',
            hp: 39,
            atk: 52,
            def: 43,
            spd: 65,
            desc: 'The flame at the tip of its tail indicates its emotions. When happy, its tail burns brightly.'
        }, {
            id: 7,
            name: 'Squirtle',
            icon: 'üíß',
            types: ['Water'],
            color: '#6890F0',
            hp: 44,
            atk: 48,
            def: 65,
            spd: 43,
            desc: 'After birth, its back swells and hardens into a shell. It powerfully sprays foam from its mouth.'
        }, {
            id: 25,
            name: 'Pikachu',
            icon: '‚ö°',
            types: ['Electric'],
            color: '#F8D030',
            hp: 35,
            atk: 55,
            def: 40,
            spd: 90,
            desc: 'When several of these Pok√©mon gather, their electricity can cause lightning storms.'
        }, {
            id: 39,
            name: 'Jigglypuff',
            icon: 'üéµ',
            types: ['Normal', 'Fairy'],
            color: '#F85888',
            hp: 115,
            atk: 45,
            def: 20,
            spd: 20,
            desc: 'Its vocal cords can freely adjust the wavelength of its voice to match anyone\'s hearing.'
        }, {
            id: 52,
            name: 'Meowth',
            icon: 'üê±',
            types: ['Normal'],
            color: '#A8A878',
            hp: 40,
            atk: 45,
            def: 35,
            spd: 90,
            desc: 'All it does is sleep during the daytime. At night, it patrols its territory with its eyes lit.'
        }, {
            id: 54,
            name: 'Psyduck',
            icon: 'ü¶Ü',
            types: ['Water'],
            color: '#6890F0',
            hp: 50,
            atk: 52,
            def: 48,
            spd: 55,
            desc: 'Always tormented by headaches. If the pain gets unbearable, it inadvertently uses psych power.'
        }, {
            id: 63,
            name: 'Abra',
            icon: 'üîÆ',
            types: ['Psychic'],
            color: '#F85888',
            hp: 25,
            atk: 20,
            def: 15,
            spd: 90,
            desc: 'Using its ability to read minds, it will identify impending danger and teleport to safety.'
        }, {
            id: 74,
            name: 'Geodude',
            icon: 'ü™®',
            types: ['Rock', 'Ground'],
            color: '#B8A038',
            hp: 40,
            atk: 80,
            def: 100,
            spd: 20,
            desc: 'Found in fields and mountains. Mistaking them for boulders, people often step on them.'
        }, {
            id: 92,
            name: 'Gastly',
            icon: 'üëª',
            types: ['Ghost', 'Poison'],
            color: '#705898',
            hp: 30,
            atk: 35,
            def: 30,
            spd: 80,
            desc: 'Almost invisible, this gaseous Pok√©mon cloaks the target and puts it to sleep without notice.'
        }, {
            id: 104,
            name: 'Cubone',
            icon: 'ü¶¥',
            types: ['Ground'],
            color: '#B8A038',
            hp: 50,
            atk: 50,
            def: 95,
            spd: 35,
            desc: 'Wears the skull of its dead mother. The cries it makes while weeping are said to be horrifying.'
        }, {
            id: 113,
            name: 'Chansey',
            icon: 'ü•ö',
            types: ['Normal'],
            color: '#F85888',
            hp: 250,
            atk: 5,
            def: 5,
            spd: 50,
            desc: 'Carries a precious egg. It will share its egg if it likes its Trainer, but only once in a while.'
        }, {
            id: 120,
            name: 'Staryu',
            icon: '‚≠ê',
            types: ['Water'],
            color: '#6890F0',
            hp: 30,
            atk: 45,
            def: 55,
            spd: 85,
            desc: 'Its center section is called the core. It glows red even in the deepest darkness of the night.'
        }, {
            id: 129,
            name: 'Magikarp',
            icon: 'üêü',
            types: ['Water'],
            color: '#6890F0',
            hp: 20,
            atk: 10,
            def: 55,
            spd: 80,
            desc: 'Famous for being very unreliable. It can be dragged along by even a slow-moving current.'
        }, {
            id: 133,
            name: 'Eevee',
            icon: 'ü¶ä',
            types: ['Normal'],
            color: '#A8A878',
            hp: 55,
            atk: 55,
            def: 50,
            spd: 55,
            desc: 'Its genetic code is irregular. It may mutate if it is exposed to radiation from element stones.'
        }, {
            id: 143,
            name: 'Snorlax',
            icon: 'üò¥',
            types: ['Normal'],
            color: '#A8A878',
            hp: 160,
            atk: 110,
            def: 65,
            spd: 30,
            desc: 'Its stomach can digest any kind of food, even if it happens to be moldy or rotten.'
        }, {
            id: 147,
            name: 'Dratini',
            icon: 'üêâ',
            types: ['Dragon'],
            color: '#6F35FC',
            hp: 41,
            atk: 64,
            def: 45,
            spd: 50,
            desc: 'A mythical Pok√©mon that was long considered as a myth until its discovery confirmed the legend.'
        }, {
            id: 150,
            name: 'Mewtwo',
            icon: 'üß¨',
            types: ['Psychic'],
            color: '#F85888',
            hp: 106,
            atk: 110,
            def: 90,
            spd: 130,
            desc: 'A Pok√©mon created by recombining Mew\'s genes. It\'s said to have the most savage heart.'
        }, ];

        const TYPE_COLORS = {
            'Fire': '#F08030',
            'Water': '#6890F0',
            'Grass': '#78C850',
            'Electric': '#F8D030',
            'Psychic': '#F85888',
            'Normal': '#A8A878',
            'Ghost': '#705898',
            'Dragon': '#6F35FC',
            'Poison': '#A040A0',
            'Ground': '#E0C068',
            'Rock': '#B8A038',
            'Fairy': '#EE99AC',
        };

        const MOVES = ['Quick Attack', 'Tackle', 'Scratch', 'Ember', 'Bubble', 'Thunder Shock', 'Pound', 'Lick'];
        const MOVE_POWERS = [40, 35, 40, 40, 40, 40, 35, 30];

        // ===== GAME STATE =====
        let gameState = {
            trainerName: 'TRAINER RED',
            team: null,
            teamEmoji: '',
            level: 1,
            xp: 150,
            xpNeeded: 1000,
            coins: 500,
            stardust: 3500,
            caught: {}, // id -> count
            seen: new Set(),
            myPokemon: [], // {id, cp, moves}
            inventory: {
                pokeballs: 15,
                greatballs: 8,
                ultraballs: 3,
                razzberies: 5,
                potions: 10,
                superPotions: 5,
                hyperPotions: 2,
                revives: 4,
                lureModules: 2,
                incense: 1,
                eggs: 3,
                starPieces: 2,
                luckyEggs: 1,
            },
            km: 0,
            battles: 0,
            wins: 0,
            currentBall: 'poke',
            berryActive: false,
            currentEncounter: null,
            pokestopsCooling: new Set(),
            spawns: [],
            pokestops: [],
            gyms: [],
        };

        // ===== MAP CANVAS =====
        const mapCanvas = document.getElementById('mapCanvas');
        const mapCtx = mapCanvas.getContext('2d');
        let mapOffset = {
            x: 0,
            y: 0
        };
        let isDragging = false;
        let dragStart = {
            x: 0,
            y: 0
        };
        let playerPos = {
            x: 0,
            y: 0
        };

        function resizeCanvas() {
            mapCanvas.width = window.innerWidth;
            mapCanvas.height = window.innerHeight;
            playerPos.x = mapCanvas.width / 2;
            playerPos.y = mapCanvas.height / 2;
            drawMap();
            updatePlayerMarker();
        }

        function drawMap() {
            const w = mapCanvas.width;
            const h = mapCanvas.height;
            const ctx = mapCtx;
            const ox = mapOffset.x;
            const oy = mapOffset.y;

            // Background (grass)
            ctx.fillStyle = '#2d6a4f';
            ctx.fillRect(0, 0, w, h);

            // Roads
            const roadGap = 150;
            ctx.strokeStyle = '#4a4a5a';
            ctx.lineWidth = 22;
            for (let x = ((ox * 0.3) % roadGap) - roadGap; x < w + roadGap; x += roadGap) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }
            for (let y = ((oy * 0.3) % roadGap) - roadGap; y < h + roadGap; y += roadGap) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }

            // Road center lines
            ctx.strokeStyle = 'rgba(255,255,255,0.15)';
            ctx.lineWidth = 2;
            ctx.setLineDash([15, 20]);
            for (let x = ((ox * 0.3) % roadGap) - roadGap; x < w + roadGap; x += roadGap) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, h);
                ctx.stroke();
            }
            for (let y = ((oy * 0.3) % roadGap) - roadGap; y < h + roadGap; y += roadGap) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(w, y);
                ctx.stroke();
            }
            ctx.setLineDash([]);

            // Parks / water bodies
            const parkPositions = [{
                x: 180,
                y: 200
            }, {
                x: -100,
                y: 350
            }, {
                x: 300,
                y: -50
            }, {
                x: -250,
                y: -200
            }];
            parkPositions.forEach(p => {
                const px = p.x + ox * 0.5 + w / 2;
                const py = p.y + oy * 0.5 + h / 2;
                ctx.fillStyle = '#40916c';
                ctx.beginPath();
                ctx.rect(px - 60, py - 40, 120, 80);
                ctx.fill();
                ctx.fillStyle = '#2d9cdb';
                ctx.beginPath();
                ctx.ellipse(px, py + 10, 30, 15, 0, 0, Math.PI * 2);
                ctx.fill();
            });

            // Buildings
            const bldgSeed = [{
                x: -80,
                y: -60,
                w: 55,
                h: 55,
                c: '#3a4a5a'
            }, {
                x: 100,
                y: -120,
                w: 45,
                h: 65,
                c: '#4a3a4a'
            }, {
                x: -200,
                y: 60,
                w: 60,
                h: 50,
                c: '#3a5a3a'
            }, {
                x: 200,
                y: 100,
                w: 50,
                h: 70,
                c: '#5a4a3a'
            }, {
                x: 50,
                y: 200,
                w: 40,
                h: 45,
                c: '#3a4a6a'
            }, {
                x: -150,
                y: -150,
                w: 55,
                h: 60,
                c: '#4a3a5a'
            }, {
                x: 300,
                y: -200,
                w: 45,
                h: 55,
                c: '#5a3a3a'
            }, {
                x: -300,
                y: 200,
                w: 60,
                h: 65,
                c: '#3a5a5a'
            }, ];
            bldgSeed.forEach(b => {
                const bx = b.x + ox * 0.5 + w / 2;
                const by = b.y + oy * 0.5 + h / 2;
                ctx.fillStyle = b.c;
                ctx.fillRect(bx - b.w / 2, by - b.h / 2, b.w, b.h);
                ctx.fillStyle = 'rgba(255,255,200,0.2)';
                for (let wy = 0; wy < 4; wy++) {
                    for (let wx = 0; wx < 3; wx++) {
                        if (Math.random() > 0.3) {
                            ctx.fillRect(bx - b.w / 2 + 5 + wx * 14, by - b.h / 2 + 8 + wy * 12, 8, 7);
                        }
                    }
                }
            });

            // Trees
            const treePositions = [{
                x: -70,
                y: 120
            }, {
                x: 120,
                y: 80
            }, {
                x: -180,
                y: -80
            }, {
                x: 250,
                y: 180
            }, {
                x: -50,
                y: -200
            }, {
                x: 350,
                y: 50
            }, {
                x: -280,
                y: 150
            }];
            treePositions.forEach(t => {
                const tx = t.x + ox * 0.5 + w / 2;
                const ty = t.y + oy * 0.5 + h / 2;
                ctx.fillStyle = '#1a6b3a';
                ctx.beginPath();
                ctx.arc(tx, ty, 18, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#228b22';
                ctx.beginPath();
                ctx.arc(tx - 5, ty - 5, 12, 0, Math.PI * 2);
                ctx.fill();
            });

            // Player range circle
            ctx.beginPath();
            ctx.arc(w / 2, h / 2, 100, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255,214,10,0.2)';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = 'rgba(255,214,10,0.04)';
            ctx.fill();
        }

        // ===== MAP DRAG =====
        mapCanvas.addEventListener('mousedown', e => {
            isDragging = true;
            dragStart = {
                x: e.clientX - mapOffset.x,
                y: e.clientY - mapOffset.y
            };
        });
        window.addEventListener('mousemove', e => {
            if (!isDragging) return;
            mapOffset.x = e.clientX - dragStart.x;
            mapOffset.y = e.clientY - dragStart.y;
            drawMap();
            updateSpawnPositions();
        });
        window.addEventListener('mouseup', () => {
            isDragging = false;
        });

        mapCanvas.addEventListener('touchstart', e => {
            if (e.touches.length === 1) {
                isDragging = true;
                dragStart = {
                    x: e.touches[0].clientX - mapOffset.x,
                    y: e.touches[0].clientY - mapOffset.y
                };
            }
        });
        window.addEventListener('touchmove', e => {
            if (!isDragging || e.touches.length !== 1) return;
            e.preventDefault();
            mapOffset.x = e.touches[0].clientX - dragStart.x;
            mapOffset.y = e.touches[0].clientY - dragStart.y;
            drawMap();
            updateSpawnPositions();
        }, {
            passive: false
        });
        window.addEventListener('touchend', () => {
            isDragging = false;
        });

        // ===== ENCOUNTER CANVAS =====
        const encCanvas = document.getElementById('encounterCanvas');
        const encCtx = encCanvas.getContext('2d');

        function drawEncounterBackground() {
            encCanvas.width = window.innerWidth;
            encCanvas.height = window.innerHeight;
            const w = encCanvas.width,
                h = encCanvas.height;

            // Sky gradient
            const skyGrad = encCtx.createLinearGradient(0, 0, 0, h * 0.6);
            skyGrad.addColorStop(0, '#87CEEB');
            skyGrad.addColorStop(1, '#B0E0E6');
            encCtx.fillStyle = skyGrad;
            encCtx.fillRect(0, 0, w, h * 0.6);

            // Ground
            const groundGrad = encCtx.createLinearGradient(0, h * 0.6, 0, h);
            groundGrad.addColorStop(0, '#90EE90');
            groundGrad.addColorStop(1, '#5a8a5a');
            encCtx.fillStyle = groundGrad;
            encCtx.fillRect(0, h * 0.6, w, h * 0.4);

            // Clouds
            encCtx.fillStyle = 'rgba(255,255,255,0.8)';
            [
                [80, 60, 50],
                [200, 80, 40],
                [w - 120, 50, 60]
            ].forEach(([x, y, r]) => {
                encCtx.beginPath();
                encCtx.arc(x, y, r, 0, Math.PI * 2);
                encCtx.fill();
                encCtx.beginPath();
                encCtx.arc(x + r * 0.6, y + 10, r * 0.7, 0, Math.PI * 2);
                encCtx.fill();
            });

            // Trees bg
            for (let i = 0; i < 5; i++) {
                const tx = 60 + i * (w / 4);
                const ty = h * 0.6 - 20;
                encCtx.fillStyle = '#1a5c28';
                encCtx.beginPath();
                encCtx.moveTo(tx, ty - 60);
                encCtx.lineTo(tx - 30, ty);
                encCtx.lineTo(tx + 30, ty);
                encCtx.closePath();
                encCtx.fill();
            }

            // Player silhouette
            const playerX = 80,
                playerY = h * 0.72;
            encCtx.fillStyle = '#333';
            encCtx.beginPath();
            encCtx.arc(playerX, playerY - 40, 15, 0, Math.PI * 2);
            encCtx.fill();
            encCtx.fillRect(playerX - 10, playerY - 25, 20, 35);
        }

        // ===== PLAYER MARKER =====
        function updatePlayerMarker() {
            const pm = document.getElementById('playerMarker');
            pm.style.left = (window.innerWidth / 2 - 25) + 'px';
            pm.style.top = (window.innerHeight / 2 - 25) + 'px';
        }

        // ===== SPAWNS =====
        function createSpawns() {
            gameState.spawns = [];
            const count = 10;
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;

            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2;
                const radius = 80 + Math.random() * 200;
                const pokemon = POKEMON_DATA[Math.floor(Math.random() * POKEMON_DATA.length)];
                const cp = Math.floor(100 + Math.random() * 800);
                gameState.spawns.push({
                    id: 's' + i,
                    pokemon,
                    cp,
                    baseX: centerX + Math.cos(angle) * radius,
                    baseY: centerY + Math.sin(angle) * radius,
                });
                gameState.seen.add(pokemon.id);
            }
            renderSpawns();
            updateNearby();
        }

        function createPokestops() {
            gameState.pokestops = [];
            const positions = [{
                x: -150,
                y: -150
            }, {
                x: 200,
                y: -100
            }, {
                x: -200,
                y: 150
            }, {
                x: 250,
                y: 200
            }, {
                x: 50,
                y: -250
            }, {
                x: -50,
                y: 300
            }];
            const container = document.getElementById('pokestopsContainer');
            container.innerHTML = '';
            positions.forEach((p, i) => {
                gameState.pokestops.push({
                    id: 'ps' + i,
                    baseX: p.x,
                    baseY: p.y,
                    cooling: false
                });
                const el = document.createElement('div');
                el.className = 'pokestop-indicator';
                el.id = 'pokestop_' + i;
                el.innerHTML = `<div class="pokestop-cube">üîµ</div>`;
                el.onclick = () => spinPokestop(i);
                container.appendChild(el);
            });
            updatePokestopPositions();
        }

        function createGyms() {
            gameState.gyms = [];
            const positions = [{
                x: 0,
                y: -200
            }, {
                x: 300,
                y: 100
            }, {
                x: -300,
                y: 50
            }];
            const teams = ['üî¥', 'üîµ', 'üü°'];
            const teamNames = ['Valor', 'Mystic', 'Instinct'];
            const container = document.getElementById('gymsContainer');
            container.innerHTML = '';
            positions.forEach((p, i) => {
                const poke = POKEMON_DATA[Math.floor(Math.random() * POKEMON_DATA.length)];
                gameState.gyms.push({
                    id: 'g' + i,
                    baseX: p.x,
                    baseY: p.y,
                    team: teamNames[i % 3],
                    teamEmoji: teams[i % 3],
                    defender: poke
                });
                const el = document.createElement('div');
                el.className = 'gym-indicator';
                el.id = 'gym_' + i;
                el.innerHTML = `<div class="gym-tower">üèüÔ∏è</div><div style="font-size:9px;font-family:'Orbitron'">${teams[i % 3]} ${teamNames[i % 3]}</div>`;
                el.onclick = () => startGymBattle(i);
                container.appendChild(el);
            });
            updateGymPositions();
        }

        function updateSpawnPositions() {
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            gameState.spawns.forEach(s => {
                const el = document.getElementById('spawn_' + s.id);
                if (el) {
                    el.style.left = (s.baseX + mapOffset.x * 0.5 - cx) + cx - 20 + 'px';
                    el.style.top = (s.baseY + mapOffset.y * 0.5 - cy) + cy - 30 + 'px';
                }
            });
            updatePokestopPositions();
            updateGymPositions();
        }

        function updatePokestopPositions() {
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            gameState.pokestops.forEach((ps, i) => {
                const el = document.getElementById('pokestop_' + i);
                if (el) {
                    el.style.left = (cx + ps.baseX + mapOffset.x * 0.3 - 15) + 'px';
                    el.style.top = (cy + ps.baseY + mapOffset.y * 0.3 - 30) + 'px';
                }
            });
        }

        function updateGymPositions() {
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            gameState.gyms.forEach((g, i) => {
                const el = document.getElementById('gym_' + i);
                if (el) {
                    el.style.left = (cx + g.baseX + mapOffset.x * 0.3 - 20) + 'px';
                    el.style.top = (cy + g.baseY + mapOffset.y * 0.3 - 40) + 'px';
                }
            });
        }

        function renderSpawns() {
            const container = document.getElementById('spawnsContainer');
            container.innerHTML = '';
            gameState.spawns.forEach(s => {
                const el = document.createElement('div');
                el.className = 'spawn-marker';
                el.id = 'spawn_' + s.id;
                el.innerHTML = `<div class="spawn-icon">${s.pokemon.icon}</div><div class="spawn-shadow"></div>`;
                el.onclick = () => startEncounter(s);
                container.appendChild(el);
            });
            updateSpawnPositions();
        }

        function updateNearby() {
            const grid = document.getElementById('nearbyGrid');
            grid.innerHTML = '';
            const nearby = gameState.spawns.slice(0, 9);
            nearby.forEach(s => {
                const div = document.createElement('div');
                div.className = 'nearby-item';
                div.innerHTML = s.pokemon.icon;
                div.title = s.pokemon.name;
                div.onclick = () => startEncounter(s);
                grid.appendChild(div);
            });
        }

        // ===== ENCOUNTER =====
        function startEncounter(spawn) {
            gameState.currentEncounter = spawn;
            gameState.seen.add(spawn.pokemon.id);

            document.getElementById('encName').textContent = spawn.pokemon.name;
            document.getElementById('encType').textContent = spawn.pokemon.types.map(t => t).join(' ¬∑ ');
            document.getElementById('encCp').textContent = 'CP ' + spawn.cp;
            document.getElementById('encSprite').textContent = spawn.pokemon.icon;
            document.getElementById('encounterScreen').style.display = 'block';

            drawEncounterBackground();
            updateBallCounts();

            gameState.berryActive = false;
            const catchRing = document.getElementById('catchRingInner');
            catchRing.style.borderColor = 'rgba(100,255,100,0.7)';
        }

        function escapeEncounter() {
            document.getElementById('encounterScreen').style.display = 'none';
            gameState.currentEncounter = null;
            showNotification('Got away safely!', '#ffd60a');
        }

        function selectBall(type, el) {
            document.querySelectorAll('.ball-option').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
            gameState.currentBall = type;
        }

        function useRazzBerry() {
            if (gameState.inventory.razzberies <= 0) {
                showNotification('No Razz Berries!', '#e63946');
                return;
            }
            gameState.inventory.razzberies--;
            gameState.berryActive = true;
            document.getElementById('berryCount').textContent = gameState.inventory.razzberies;
            showNotification('Razz Berry used! üçì Better catch chance!', '#06d6a0');
            document.getElementById('catchRingInner').style.borderColor = 'rgba(255,100,100,0.9)';
        }

        function throwBall() {
            const enc = gameState.currentEncounter;
            if (!enc) return;

            let ballKey = {
                poke: 'pokeballs',
                great: 'greatballs',
                ultra: 'ultraballs'
            }[gameState.currentBall];
            if (gameState.inventory[ballKey] <= 0) {
                showNotification('No balls left! Try a different ball.', '#e63946');
                return;
            }
            gameState.inventory[ballKey]--;
            updateBallCounts();

            // Ball throw animation
            const ballEl = document.getElementById('catchBall');
            ballEl.style.display = 'block';
            ballEl.style.left = '45%';
            ballEl.style.bottom = '200px';
            ballEl.style.top = 'auto';
            ballEl.style.transition = 'all 0.6s cubic-bezier(0.17, 0.67, 0.83, 0.67)';
            setTimeout(() => {
                ballEl.style.left = '45%';
                ballEl.style.top = '35%';
                ballEl.style.bottom = 'auto';
            }, 50);

            setTimeout(() => {
                ballEl.style.display = 'none';
                // Shake animation
                let shakes = Math.floor(Math.random() * 3) + 1;
                ballEl.style.display = 'block';
                ballEl.style.top = '38%';
                ballEl.classList.add('shaking');
                setTimeout(() => ballEl.classList.remove('shaking'), 800);
                setTimeout(() => {
                    if (shakes > 1) {
                        ballEl.classList.add('shaking');
                        setTimeout(() => ballEl.classList.remove('shaking'), 800);
                    }
                }, 900);
                setTimeout(() => {
                    if (shakes > 2) {
                        ballEl.classList.add('shaking');
                        setTimeout(() => ballEl.classList.remove('shaking'), 800);
                    }
                }, 1800);

                // Determine catch
                let catchRate = 0.35;
                if (gameState.currentBall === 'great') catchRate = 0.55;
                if (gameState.currentBall === 'ultra') catchRate = 0.75;
                if (gameState.berryActive) catchRate = Math.min(catchRate * 1.5, 0.95);
                catchRate = Math.min(catchRate + enc.cp / 5000, 0.95);

                const caught = Math.random() < catchRate;
                const delay = shakes * 900 + 600;

                setTimeout(() => {
                    ballEl.style.display = 'none';
                    if (caught) {
                        handleCatch(enc);
                    } else {
                        // Pokemon breaks out
                        document.getElementById('encSprite').style.animation = 'popIn 0.5s ease';
                        showNotification(`${enc.pokemon.name} broke free! üò±`, '#e63946');
                        setTimeout(() => document.getElementById('encSprite').style.animation = 'float 3s ease-in-out infinite', 500);

                        // Sometimes flees
                        if (Math.random() < 0.2) {
                            setTimeout(() => {
                                document.getElementById('encounterScreen').style.display = 'none';
                                gameState.currentEncounter = null;
                                showNotification(`${enc.pokemon.name} fled! üí®`, '#e63946');
                            }, 1000);
                        }
                    }
                    gameState.berryActive = false;
                }, delay);
            }, 650);
        }

        function handleCatch(spawn) {
            document.getElementById('encounterScreen').style.display = 'none';

            // Update data
            if (!gameState.caught[spawn.pokemon.id]) gameState.caught[spawn.pokemon.id] = 0;
            gameState.caught[spawn.pokemon.id]++;

            const moves = [MOVES[Math.floor(Math.random() * MOVES.length)], MOVES[Math.floor(Math.random() * MOVES.length)]];
            const newPoke = {
                id: spawn.pokemon.id,
                cp: spawn.cp,
                moves,
                name: spawn.pokemon.name,
                icon: spawn.pokemon.icon
            };
            gameState.myPokemon.push(newPoke);

            // XP + Stardust
            const xpGained = 100 + Math.floor(spawn.cp / 5);
            const stardustGained = 100;
            addXP(xpGained);
            gameState.stardust += stardustGained;

            // Remove spawn
            gameState.spawns = gameState.spawns.filter(s => s.id !== spawn.id);
            const spawnEl = document.getElementById('spawn_' + spawn.id);
            if (spawnEl) spawnEl.remove();
            updateNearby();

            // Refresh spawn after delay
            setTimeout(() => spawnNewPokemon(), 15000);

            // Show catch result
            const resultEl = document.getElementById('catchResult');
            resultEl.style.display = 'flex';
            document.getElementById('resultEmoji').textContent = spawn.pokemon.icon;
            document.getElementById('resultText').textContent = `${spawn.pokemon.name} Caught! üéâ`;
            document.getElementById('resultText').className = 'result-text success';
            document.getElementById('resultXp').textContent = `+${xpGained} XP ¬∑ +${stardustGained} Stardust`;

            updateHUD();
        }

        function closeCatchResult() {
            document.getElementById('catchResult').style.display = 'none';
            gameState.currentEncounter = null;
        }

        function spawnNewPokemon() {
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            const radius = 100 + Math.random() * 200;
            const pokemon = POKEMON_DATA[Math.floor(Math.random() * POKEMON_DATA.length)];
            const cp = Math.floor(100 + Math.random() * 800);
            const newSpawn = {
                id: 's' + Date.now(),
                pokemon,
                cp,
                baseX: cx + Math.cos(angle) * radius,
                baseY: cy + Math.sin(angle) * radius,
            };
            gameState.spawns.push(newSpawn);
            gameState.seen.add(pokemon.id);

            const container = document.getElementById('spawnsContainer');
            const el = document.createElement('div');
            el.className = 'spawn-marker';
            el.id = 'spawn_' + newSpawn.id;
            el.innerHTML = `<div class="spawn-icon">${pokemon.icon}</div><div class="spawn-shadow"></div>`;
            el.onclick = () => startEncounter(newSpawn);
            container.appendChild(el);
            updateSpawnPositions();
            updateNearby();
            showNotification(`A wild ${pokemon.name} appeared! ${pokemon.icon}`, '#ffd60a');
        }

        // ===== POKESTOPS =====
        function spinPokestop(index) {
            const ps = gameState.pokestops[index];
            if (ps.cooling) {
                showNotification('Pok√©Stop is cooling down... ‚è∞', '#e63946');
                return;
            }

            const overlay = document.getElementById('pokestopSpin');
            overlay.style.display = 'flex';
            document.getElementById('spinResultText').textContent = 'SPINNING...';
            document.getElementById('spinItems').innerHTML = '';
            document.getElementById('pokestopCloseBtn').style.display = 'none';

            const rewards = [];
            const items = ['üî¥', 'üíä', '‚ú®', 'ü•ö', 'üîµ'];
            const itemNames = ['Pok√© Ball', 'Potion', 'Stardust', 'Egg', 'Great Ball'];
            const count = Math.floor(Math.random() * 4) + 2;
            for (let i = 0; i < count; i++) {
                const idx = Math.floor(Math.random() * items.length);
                rewards.push({
                    item: items[idx],
                    name: itemNames[idx]
                });
            }

            setTimeout(() => {
                document.getElementById('spinResultText').textContent = 'ITEMS COLLECTED!';
                document.getElementById('spinItems').innerHTML = rewards.map(r => r.item).join('');
                document.getElementById('pokestopCloseBtn').style.display = 'block';

                // Apply rewards
                rewards.forEach(r => {
                    if (r.name === 'Pok√© Ball') gameState.inventory.pokeballs++;
                    else if (r.name === 'Potion') gameState.inventory.potions++;
                    else if (r.name === 'Stardust') gameState.stardust += 50;
                    else if (r.name === 'Egg') gameState.inventory.eggs++;
                    else if (r.name === 'Great Ball') gameState.inventory.greatballs++;
                });
                addXP(50);
                updateHUD();

                // Cooldown
                ps.cooling = true;
                const psEl = document.getElementById('pokestop_' + index);
                if (psEl) {
                    psEl.querySelector('.pokestop-cube').style.filter = 'grayscale(1) brightness(0.5)';
                }
                setTimeout(() => {
                    ps.cooling = false;
                    if (psEl) psEl.querySelector('.pokestop-cube').style.filter = '';
                }, 300000); // 5 min cooldown
            }, 2000);
        }

        function closePokestop() {
            document.getElementById('pokestopSpin').style.display = 'none';
        }

        // ===== GYM BATTLE =====
        let battleState = {};

        function startGymBattle(gymIndex) {
            if (gameState.myPokemon.length === 0) {
                showNotification('You need Pok√©mon to battle! Catch some first!', '#e63946');
                return;
            }

            const gym = gameState.gyms[gymIndex];
            const myPoke = gameState.myPokemon[0];
            const myPokeData = POKEMON_DATA.find(p => p.id === myPoke.id);
            const enemyPokeData = gym.defender;

            battleState = {
                myMaxHp: myPokeData.hp * 2,
                myHp: myPokeData.hp * 2,
                enemyMaxHp: enemyPokeData.hp * 2,
                enemyHp: enemyPokeData.hp * 2,
                myPoke: myPokeData,
                enemyPoke: enemyPokeData,
                myCP: myPoke.cp,
                enemyCP: Math.floor(400 + Math.random() * 600),
                moves: myPoke.moves || [MOVES[0], MOVES[1]],
                gymIndex
            };

            document.getElementById('gymBattleInner').style.display = 'flex';
            document.getElementById('gymBattleInner').style.flexDirection = 'column';
            document.getElementById('gymBattleScreen').style.display = 'flex';

            document.getElementById('myBattlePoke').textContent = myPokeData.icon;
            document.getElementById('myBattleName').textContent = myPokeData.name;
            document.getElementById('enemyBattlePoke').textContent = enemyPokeData.icon;
            document.getElementById('enemyBattleName').textContent = enemyPokeData.name;
            document.getElementById('myHpBar').style.width = '100%';
            document.getElementById('enemyHpBar').style.width = '100%';
            document.getElementById('battleLog').textContent = `${gym.team} ${gym.teamEmoji} Gym! Battle begins! üî•`;

            renderBattleMoves();
        }

        function renderBattleMoves() {
            const moves = battleState.moves;
            document.getElementById('battleMoves').innerHTML = moves.map((m, i) => `
    <div class="move-btn" onclick="useMove(${i})">
      <div>${m}</div>
      <div class="move-power">Power: ${MOVE_POWERS[MOVES.indexOf(m)] || 40}</div>
    </div>
  `).join('') + `
    <div class="move-btn" onclick="useDodge()">
      <div>‚ö° Dodge</div>
      <div class="move-power">Reduce damage</div>
    </div>
  `;
        }

        function useMove(moveIndex) {
            if (battleState.myHp <= 0 || battleState.enemyHp <= 0) return;

            const moveName = battleState.moves[moveIndex];
            const movePower = MOVE_POWERS[MOVES.indexOf(moveName)] || 40;
            const dmgToEnemy = Math.floor(movePower * (battleState.myCP / battleState.enemyCP) * (0.8 + Math.random() * 0.4));
            const dmgToMe = Math.floor(20 * (battleState.enemyCP / battleState.myCP) * (0.7 + Math.random() * 0.4));

            battleState.enemyHp = Math.max(0, battleState.enemyHp - dmgToEnemy);
            battleState.myHp = Math.max(0, battleState.myHp - dmgToMe);

            document.getElementById('enemyHpBar').style.width = (battleState.enemyHp / battleState.enemyMaxHp * 100) + '%';
            document.getElementById('myHpBar').style.width = (battleState.myHp / battleState.myMaxHp * 100) + '%';
            document.getElementById('battleLog').textContent =
                `${battleState.myPoke.name} used ${moveName}! Dealt ${dmgToEnemy} damage!\n${battleState.enemyPoke.name} attacks back for ${dmgToMe}!`;

            checkBattleEnd();
        }

        function useDodge() {
            document.getElementById('battleLog').textContent = `${battleState.myPoke.name} dodged! Reduced incoming damage!`;
            const dmgToEnemy = Math.floor(15 * (0.8 + Math.random() * 0.4));
            battleState.enemyHp = Math.max(0, battleState.enemyHp - dmgToEnemy);
            document.getElementById('enemyHpBar').style.width = (battleState.enemyHp / battleState.enemyMaxHp * 100) + '%';
            checkBattleEnd();
        }

        function checkBattleEnd() {
            if (battleState.enemyHp <= 0) {
                document.getElementById('battleLog').textContent = `üèÜ You won the Gym Battle! +500 XP!`;
                addXP(500);
                gameState.stardust += 500;
                gameState.wins++;
                gameState.battles++;
                updateHUD();
                setTimeout(() => closeGymBattle(), 2000);
            } else if (battleState.myHp <= 0) {
                document.getElementById('battleLog').textContent = `üíÄ Your Pok√©mon fainted... Better luck next time!`;
                gameState.battles++;
                setTimeout(() => closeGymBattle(), 2000);
            }
        }

        function closeGymBattle() {
            document.getElementById('gymBattleScreen').style.display = 'none';
            document.getElementById('gymBattleInner').style.display = 'none';
        }

        // ===== SCREENS =====
        function showPokedex() {
            const screen = document.getElementById('pokedexScreen');
            screen.style.display = 'block';
            renderPokedex('all');
            const caught = Object.keys(gameState.caught).length;
            document.getElementById('dexCount').textContent = `${caught} / ${POKEMON_DATA.length} Caught`;
        }

        function renderPokedex(filter) {
            const grid = document.getElementById('pokedexGrid');
            grid.innerHTML = '';
            POKEMON_DATA.forEach(p => {
                const isCaught = !!gameState.caught[p.id];
                const isSeen = gameState.seen.has(p.id);
                let state = isCaught ? 'caught' : (isSeen ? 'seen' : 'unseen');

                if (filter === 'caught' && !isCaught) return;
                if (filter === 'seen' && (isCaught || !isSeen)) return;
                if (filter === 'unseen' && isSeen) return;

                const el = document.createElement('div');
                el.className = `pokedex-entry ${state}`;
                el.onclick = () => showPokemonDetail(p, isCaught);
                el.innerHTML = `
      <div class="poke-icon">${isSeen ? p.icon : '‚ùì'}</div>
      <div class="poke-num">#${String(p.id).padStart(3,'0')}</div>
      <div class="poke-dex-name">${isSeen ? p.name : '???'}</div>
      ${isCaught ? '<div class="caught-badge">‚úÖ</div>' : ''}
    `;
                grid.appendChild(el);
            });
        }

        function filterDex(filter, el) {
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            renderPokedex(filter);
        }

        function showPokemonDetail(poke, isCaught) {
            document.getElementById('pokemonDetail').style.display = 'block';
            document.getElementById('detailBg').style.background = `linear-gradient(180deg, ${poke.color}33, #0d1117)`;
            document.getElementById('detailNum').textContent = `#${String(poke.id).padStart(3,'0')}`;
            document.getElementById('detailIcon').textContent = poke.icon;
            document.getElementById('detailName').textContent = poke.name;
            document.getElementById('detailDesc').textContent = poke.desc;
            document.getElementById('detailCount').textContent = `x${gameState.caught[poke.id] || 0}`;

            var foundPoke = gameState.myPokemon.find(function(p) {
                return p.id === poke.id;
            });
            var cp = isCaught ? (foundPoke ? foundPoke.cp : 0) : '???';
            document.getElementById('detailCp').textContent = isCaught ? `CP ${cp}` : '???';

            const typesEl = document.getElementById('detailTypes');
            typesEl.innerHTML = poke.types.map(t =>
                `<span class="type-badge" style="background:${TYPE_COLORS[t] || '#888'}33;border:1px solid ${TYPE_COLORS[t] || '#888'};color:${TYPE_COLORS[t] || '#888'}">${t}</span>`
            ).join('');

            const stats = ['Hp', 'Atk', 'Def', 'Spd'];
            stats.forEach(s => {
                const val = poke[s.toLowerCase()];
                const pct = Math.min(100, (val / 250) * 100);
                document.getElementById('stat' + s).style.width = pct + '%';
                document.getElementById('stat' + s + 'Val').textContent = val;
            });
        }

        function showMyPokemon() {
            const screen = document.getElementById('myPokemonScreen');
            screen.style.display = 'block';
            document.getElementById('pokemonCount').textContent = `${gameState.myPokemon.length} Pok√©mon`;

            const list = document.getElementById('myPokemonList');
            list.innerHTML = '';

            if (gameState.myPokemon.length === 0) {
                list.innerHTML = '<div style="text-align:center;padding:50px;color:rgba(255,255,255,0.3);font-family:\'Orbitron\';font-size:14px">NO POK√âMON YET<br><br>Catch some on the map!</div>';
                return;
            }

            [...gameState.myPokemon].sort((a, b) => b.cp - a.cp).forEach(p => {
                const pokeData = POKEMON_DATA.find(pd => pd.id === p.id);
                const el = document.createElement('div');
                el.className = 'my-poke-card';
                el.onclick = () => showPokemonDetail(pokeData, true);
                el.innerHTML = `
      <div class="my-poke-icon">${p.icon}</div>
      <div class="my-poke-info">
        <div class="my-poke-name">${p.name}</div>
        <div class="my-poke-cp">CP ${p.cp}</div>
        <div class="my-poke-hp">HP ${pokeData.hp * 2} ¬∑ ${(p.moves && p.moves.join(', ')) || 'No moves'}</div>
      </div>
      <div class="my-poke-arrow">‚Ä∫</div>
    `;
                list.appendChild(el);
            });
        }

        function showInventory() {
            document.getElementById('inventoryScreen').style.display = 'block';
            const items = [{
                icon: 'üî¥',
                name: 'Pok√© Ball',
                count: gameState.inventory.pokeballs
            }, {
                icon: 'üîµ',
                name: 'Great Ball',
                count: gameState.inventory.greatballs
            }, {
                icon: 'üü°',
                name: 'Ultra Ball',
                count: gameState.inventory.ultraballs
            }, {
                icon: 'üçì',
                name: 'Razz Berry',
                count: gameState.inventory.razzberies
            }, {
                icon: 'üíä',
                name: 'Potion',
                count: gameState.inventory.potions
            }, {
                icon: 'üíâ',
                name: 'Super Potion',
                count: gameState.inventory.superPotions
            }, {
                icon: 'üß™',
                name: 'Hyper Potion',
                count: gameState.inventory.hyperPotions
            }, {
                icon: 'üîÑ',
                name: 'Revive',
                count: gameState.inventory.revives
            }, {
                icon: 'üß≤',
                name: 'Lure Module',
                count: gameState.inventory.lureModules
            }, {
                icon: 'üå∏',
                name: 'Incense',
                count: gameState.inventory.incense
            }, {
                icon: 'ü•ö',
                name: 'Egg',
                count: gameState.inventory.eggs
            }, {
                icon: '‚≠ê',
                name: 'Star Piece',
                count: gameState.inventory.starPieces
            }, {
                icon: 'üçÄ',
                name: 'Lucky Egg',
                count: gameState.inventory.luckyEggs
            }, ];

            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = items.map(item => `
    <div class="inv-item" onclick="useItem('${item.name}')">
      <div class="inv-icon">${item.icon}</div>
      <div class="inv-name">${item.name}</div>
      <div class="inv-count">x${item.count}</div>
    </div>
  `).join('');
        }

        function useItem(name) {
            if (name === 'Incense' && gameState.inventory.incense > 0) {
                gameState.inventory.incense--;
                showNotification('Incense activated! Pok√©mon will find you! üå∏', '#06d6a0');
                for (let i = 0; i < 3; i++) setTimeout(() => spawnNewPokemon(), i * 5000);
                closeScreen('inventoryScreen');
            } else if (name === 'Lucky Egg' && gameState.inventory.luckyEggs > 0) {
                gameState.inventory.luckyEggs--;
                showNotification('Lucky Egg! Double XP for 30 minutes! üçÄ', '#ffd60a');
                closeScreen('inventoryScreen');
            } else {
                showNotification(`Used ${name}!`, '#06d6a0');
            }
        }

        function showProfile() {
            document.getElementById('profileScreen').style.display = 'block';
            document.getElementById('profileName').textContent = gameState.trainerName;
            document.getElementById('profileLevel').textContent = `Level ${gameState.level} Trainer`;
            document.getElementById('profileTeam').textContent = gameState.team ? `Team ${gameState.team} ${gameState.teamEmoji}` : 'No Team';
            document.getElementById('statCaught').textContent = Object.keys(gameState.caught).length;
            document.getElementById('statSeen').textContent = gameState.seen.size;
            document.getElementById('statKm').textContent = gameState.km.toFixed(1) + ' km';
            document.getElementById('statBattles').textContent = gameState.battles;
            document.getElementById('statWins').textContent = gameState.wins;
            document.getElementById('statEggs').textContent = gameState.inventory.eggs;

            const medals = [{
                icon: 'üèÖ',
                name: 'Starter'
            }, {
                icon: '‚ö°',
                name: 'Zapper'
            }, {
                icon: 'üíß',
                name: 'Fisher'
            }, {
                icon: 'üî•',
                name: 'Kindler'
            }, {
                icon: 'üå±',
                name: 'Gardener'
            }, {
                icon: 'üó∫Ô∏è',
                name: 'Explorer'
            }, {
                icon: 'üèÜ',
                name: 'Champion'
            }, {
                icon: 'üëÅÔ∏è',
                name: 'Seer'
            }, ];

            document.getElementById('medalsGrid').innerHTML = medals.map(m => `
    <div class="medal-item">
      <div class="medal-icon">${m.icon}</div>
      <div class="medal-name">${m.name}</div>
    </div>
  `).join('');
        }

        function showShop() {
            showNotification('üè™ Shop coming soon! Save your Pok√©Coins!', '#ffd60a');
        }

        function closeScreen(id) {
            document.getElementById(id).style.display = 'none';
        }

        // ===== XP & LEVELING =====
        function addXP(amount) {
            gameState.xp += amount;
            while (gameState.xp >= gameState.xpNeeded) {
                gameState.xp -= gameState.xpNeeded;
                gameState.level++;
                gameState.xpNeeded = Math.floor(gameState.xpNeeded * 1.2);
                showNotification(`üéâ LEVEL UP! You're now Level ${gameState.level}!`, '#ffd60a');
                // Reward on level up
                gameState.inventory.pokeballs += 5;
                gameState.inventory.greatballs += 2;
            }
            updateHUD();
        }

        function updateHUD() {
            const pct = (gameState.xp / gameState.xpNeeded) * 100;
            document.getElementById('xpBar').style.width = pct + '%';
            document.getElementById('levelDisplay').textContent = `LVL ${gameState.level} ¬∑ ${gameState.xp}/${gameState.xpNeeded} XP`;
            document.getElementById('coinDisplay').textContent = gameState.coins;
            document.getElementById('stardustDisplay').textContent = gameState.stardust.toLocaleString();
            document.getElementById('trainerNameDisplay').textContent = gameState.trainerName;
        }

        function updateBallCounts() {
            document.getElementById('pokeballCount').textContent = gameState.inventory.pokeballs;
            document.getElementById('greatballCount').textContent = gameState.inventory.greatballs;
            document.getElementById('ultraballCount').textContent = gameState.inventory.ultraballs;
            document.getElementById('berryCount').textContent = gameState.inventory.razzberies;
        }

        // ===== TEAM SELECT =====
        function selectTeam(team, emoji) {
            gameState.team = team;
            gameState.teamEmoji = emoji;
            document.getElementById('teamSelectScreen').style.display = 'none';
            showNotification(`Welcome to Team ${team} ${emoji}!`, team === 'Valor' ? '#e63946' : team === 'Mystic' ? '#4ecdc4' : '#ffd60a');
        }

        // ===== NOTIFICATION =====
        function showNotification(msg, color) {
            color = color || '#fff';
            const el = document.getElementById('notification');
            el.textContent = msg;
            el.style.color = color;
            el.style.borderColor = color + '44';
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        // ===== WEATHER =====
        const weathers = [{
            icon: '‚òÄÔ∏è',
            text: 'Clear'
        }, {
            icon: '‚õÖ',
            text: 'Partly Cloudy'
        }, {
            icon: 'üåßÔ∏è',
            text: 'Rainy'
        }, {
            icon: '‚ùÑÔ∏è',
            text: 'Snowy'
        }, {
            icon: 'üå©Ô∏è',
            text: 'Stormy'
        }, {
            icon: 'üå´Ô∏è',
            text: 'Foggy'
        }, ];

        function updateWeather() {
            const w = weathers[Math.floor(Math.random() * weathers.length)];
            document.getElementById('weatherIcon').textContent = w.icon;
            document.getElementById('weatherText').textContent = w.text;
        }

        // ===== SIMULATED WALKING =====
        function simulateWalking() {
            gameState.km += 0.001;
            if (Math.random() < 0.005) {
                const dx = (Math.random() - 0.5) * 4;
                const dy = (Math.random() - 0.5) * 4;
                mapOffset.x += dx;
                mapOffset.y += dy;
                drawMap();
                updateSpawnPositions();
            }
        }

        // ===== INIT =====
        function init() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                resizeCanvas();
                createSpawns();
                createPokestops();
                createGyms();
                updateHUD();
                updateBallCounts();
                updateWeather();

                // Show team select
                setTimeout(() => {
                    document.getElementById('teamSelectScreen').style.display = 'flex';
                }, 500);

                // Auto spawn
                setInterval(spawnNewPokemon, 30000);
                setInterval(updateWeather, 60000);
                setInterval(simulateWalking, 100);

                showNotification('Welcome to Pok√©Quest GO! Tap Pok√©mon to catch them! üéÆ', '#ffd60a');
            }, 2200);
        }

        window.addEventListener('resize', () => {
            resizeCanvas();
            updateSpawnPositions();
        });

        init();
    </script>
</body>

</html>
