<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo</title>
        
     <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        overflow-x: hidden;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.2) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
        z-index: -1;
        animation: gradientShift 20s ease infinite;
    }
    
    @keyframes gradientShift {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(180deg); }
    }
    
    .container {
        max-width: 1200px;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    header {
        text-align: center;
        margin-bottom: 40px;
        width: 100%;
        animation: slideDown 1s ease-out;
    }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    h1 {
        color: white;
        margin-bottom: 15px;
        font-size: 3rem;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        background: linear-gradient(to right, #ffffff, #e0e0e0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: textGlow 3s ease-in-out infinite alternate;
    }
    
    @keyframes textGlow {
        from { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3)); }
        to { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.6)); }
    }
    
    .subtitle {
        color: rgba(255, 255, 255, 0.85);
        font-size: 1.2rem;
        max-width: 600px;
        margin: 0 auto;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .main-content {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 30px;
        width: 100%;
        margin-bottom: 40px;
        animation: fadeInUp 1s ease-out 0.3s both;
    }
    
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .camera-section {
        flex: 1;
        min-width: 300px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        padding: 25px;
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .camera-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.1),
            transparent
        );
        transition: 0.5s;
    }
    
    .camera-section:hover::before {
        left: 100%;
    }
    
    .section-title {
        color: white;
        margin-bottom: 25px;
        text-align: center;
        font-size: 1.8rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        position: relative;
        display: inline-block;
    }
    
    .section-title::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 3px;
        background: linear-gradient(to right, #4facfe, #00f2fe);
        border-radius: 3px;
        animation: linePulse 2s ease-in-out infinite;
    }
    
    @keyframes linePulse {
        0%, 100% { width: 60px; opacity: 1; }
        50% { width: 80px; opacity: 0.8; }
    }
    
    .camera-container {
        width: 100%;
        height: 320px;
        background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.4));
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 25px;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 
            inset 0 2px 10px rgba(0, 0, 0, 0.5),
            0 8px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    #camera-feed {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
    }
    
    .camera-placeholder {
        color: rgba(255, 255, 255, 0.8);
        text-align: center;
        font-size: 1.2rem;
        padding: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
   .countdown-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: transparent; /* No background */
    backdrop-filter: none; /* No blur effect */
    color: white;
    font-size: 5rem;
    font-weight: bold;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
    display: none;
    box-shadow: 
        0 0 60px rgba(79, 172, 254, 0.8),
        inset 0 0 20px rgba(255, 255, 255, 0.3);
    border: 2px solid rgba(79, 172, 254, 0.5);
    animation: pulseGlow 1s ease-in-out infinite alternate;
} 
    @keyframes pulseGlow {
        from { box-shadow: 0 0 40px rgba(79, 172, 254, 0.6); }
        to { box-shadow: 0 0 80px rgba(79, 172, 254, 1); }
    }
    
    .controls {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
    }
    
    #start-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 18px 45px;
        font-size: 1.2rem;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 
            0 6px 20px rgba(102, 126, 234, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        width: 100%;
        max-width: 320px;
        position: relative;
        overflow: hidden;
        letter-spacing: 0.5px;
        text-transform: uppercase;
    }
    
    #start-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: 0.5s;
    }
    
    #start-btn:hover::before {
        left: 100%;
    }
    
    #start-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 
            0 12px 30px rgba(102, 126, 234, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }
    
    #start-btn:active {
        transform: translateY(-2px) scale(1.02);
        transition: all 0.1s ease;
    }
    
    #start-btn:disabled {
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    #start-btn:disabled::before {
        display: none;
    }
    
    .template-selector {
        width: 100%;
        margin: 20px 0;
    }
    
    .template-selector h4 {
        color: white;
        margin-bottom: 15px;
        text-align: center;
        font-size: 1.1rem;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .template-options {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
    }
    
    .template-option {
        width: 70px;
        height: 70px;
        border-radius: 15px;
        overflow: hidden;
        cursor: pointer;
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        position: relative;
    }
    
    .template-option::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .template-option:hover::after {
        opacity: 1;
    }
    
    .template-option:hover {
        transform: translateY(-5px) scale(1.1);
        border-color: #4facfe;
        box-shadow: 
            0 10px 25px rgba(79, 172, 254, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    .template-option.active {
        border-color: #2ecc71;
        box-shadow: 
            0 10px 25px rgba(46, 204, 113, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
        animation: templatePulse 2s ease-in-out infinite;
    }
    
    @keyframes templatePulse {
        0%, 100% { box-shadow: 0 10px 25px rgba(46, 204, 113, 0.6); }
        50% { box-shadow: 0 15px 30px rgba(46, 204, 113, 0.8); }
    }
    
    .template-preview {
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.15);
        display: grid;
        padding: 5px;
    }
    
    .preview-cell {
        background: rgba(79, 172, 254, 0.7);
        border-radius: 3px;
        margin: 1px;
    }
    
    .status-indicator {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 10px;
        font-weight: 600;
        color: white;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .status-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background-color: #e74c3c;
        box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        transition: all 0.3s ease;
        position: relative;
    }
    
    .status-dot::after {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border-radius: 50%;
        background: rgba(231, 76, 60, 0.3);
        animation: ripple 2s infinite;
    }
    
    @keyframes ripple {
        0% { transform: scale(0.8); opacity: 1; }
        100% { transform: scale(2); opacity: 0; }
    }
    
    .status-dot.active {
        background-color: #2ecc71;
        box-shadow: 0 0 20px rgba(46, 204, 113, 0.7);
        animation: pulse 1.5s infinite;
    }
    
    .progress-container {
        width: 100%;
        max-width: 320px;
        margin-top: 15px;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
    }
    
    .progress-bar {
        height: 10px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 
            inset 0 2px 5px rgba(0, 0, 0, 0.2),
            0 1px 0 rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4facfe, #00f2fe);
        width: 0%;
        transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        border-radius: 10px;
        position: relative;
        overflow: hidden;
    }
    
    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.4),
            transparent
        );
        animation: progressShine 2s infinite;
    }
    
    @keyframes progressShine {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    .collage-section {
        flex: 1;
        min-width: 300px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        padding: 25px;
        display: flex;
        flex-direction: column;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        animation: fadeInRight 1s ease-out 0.5s both;
    }
    
    @keyframes fadeInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
    }
    
    .collage-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.05),
            transparent
        );
        transition: 0.5s;
    }
    
    .collage-section:hover::before {
        left: 100%;
    }
    
    .collage-container {
        flex: 1;
        display: grid;
        gap: 8px;
        aspect-ratio: 1/1;
        max-height: 400px;
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 10px;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 
            inset 0 2px 10px rgba(0, 0, 0, 0.1),
            0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    .collage-cell {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        border: 2px dashed rgba(255, 255, 255, 0.2);
        position: relative;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .collage-cell:hover {
        transform: scale(1.02);
        border-color: rgba(255, 255, 255, 0.3);
        background: rgba(255, 255, 255, 0.12);
    }
    
    .collage-cell.filled {
        border: 2px solid rgba(46, 204, 113, 0.8);
        background: rgba(46, 204, 113, 0.05);
        box-shadow: 
            0 4px 15px rgba(46, 204, 113, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        animation: cellGlow 3s infinite alternate;
    }
    
    @keyframes cellGlow {
        from { box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3); }
        to { box-shadow: 0 6px 25px rgba(46, 204, 113, 0.5); }
    }
    
    .collage-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .collage-cell.filled:hover .collage-img {
        transform: scale(1.05);
    }
    
    .cell-label {
        color: rgba(255, 255, 255, 0.5);
        font-size: 1.3rem;
        font-weight: 500;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .photo-counter {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 25px;
    }
    
    .photo-indicator {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: rgba(255, 255, 255, 0.7);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border: 2px solid rgba(255, 255, 255, 0.2);
        position: relative;
        overflow: hidden;
    }
    
    .photo-indicator::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: 0.5s;
    }
    
    .photo-indicator:hover::before {
        left: 100%;
    }
    
    .photo-indicator.active {
        background: rgba(52, 152, 219, 0.3);
        color: white;
        transform: scale(1.2);
        border-color: #3498db;
        box-shadow: 
            0 0 25px rgba(52, 152, 219, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        animation: indicatorPulse 1.5s infinite;
    }
    
    @keyframes indicatorPulse {
        0%, 100% { transform: scale(1.2); }
        50% { transform: scale(1.3); }
    }
    
    .photo-indicator.captured {
        background: rgba(46, 204, 113, 0.3);
        color: white;
        border-color: #2ecc71;
        box-shadow: 
            0 0 25px rgba(46, 204, 113, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    .collage-footer {
        text-align: center;
        margin-top: 25px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 15px;
        border-left: 4px solid rgba(79, 172, 254, 0.8);
        backdrop-filter: blur(5px);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .collage-footer:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .collage-credit {
        color: white;
        font-size: 1.3rem;
        font-weight: 600;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        letter-spacing: 1px;
    }
    
    .created-by {
        color: rgba(255, 255, 255, 0.7);
        font-size: 1rem;
        margin-top: 8px;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .wizklub-badge {
        display: inline-block;
        background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: bold;
        margin: 0 5px;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        animation: badgeFloat 3s ease-in-out infinite;
    }
    
    @keyframes badgeFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
    }
    
    /* QR Code Popup Modal */
    .qr-popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.4s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .qr-popup-overlay.active {
        display: flex;
    }
    
    .qr-popup {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 25px;
        padding: 40px;
        max-width: 450px;
        width: 90%;
        text-align: center;
        box-shadow: 
            0 25px 50px rgba(0, 0, 0, 0.5),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
    }
    
    .qr-popup::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent,
            rgba(255, 255, 255, 0.05),
            transparent
        );
        animation: popupShine 10s infinite linear;
    }
    
    @keyframes popupShine {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translateY(40px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }
    
    .popup-close {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 24px;
        color: white;
        cursor: pointer;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(5px);
        z-index: 2;
    }
    
    .popup-close:hover {
        background: rgba(231, 76, 60, 0.3);
        transform: rotate(90deg) scale(1.1);
        box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
    }
    
    .popup-title {
        color: white;
        margin-bottom: 20px;
        font-size: 2rem;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        position: relative;
        z-index: 2;
    }
    
    .popup-subtitle {
        color: rgba(255, 255, 255, 0.85);
        margin-bottom: 30px;
        font-size: 1.1rem;
        line-height: 1.6;
        position: relative;
        z-index: 2;
    }
    
    .qr-code-container {
        width: 280px;
        height: 280px;
        margin: 0 auto 30px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        border: 3px solid rgba(79, 172, 254, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
        position: relative;
        z-index: 2;
        box-shadow: 
            0 10px 30px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        animation: qrFloat 6s ease-in-out infinite;
    }
    
    @keyframes qrFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }
    
    #qrcode {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    #qrcode canvas {
        border-radius: 10px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    }
    
    .popup-instruction {
        background: rgba(255, 255, 255, 0.08);
        padding: 20px;
        border-radius: 15px;
        margin: 25px 0;
        border-left: 4px solid rgba(46, 204, 113, 0.8);
        position: relative;
        z-index: 2;
        backdrop-filter: blur(5px);
    }
    
    .popup-instruction p {
        color: white;
        font-size: 1rem;
        margin-bottom: 10px;
        text-align: left;
        font-weight: 500;
    }
    
    .popup-instruction ul {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.95rem;
        text-align: left;
        padding-left: 20px;
        margin: 0;
    }
    
    .popup-instruction li {
        margin-bottom: 8px;
        line-height: 1.5;
    }
    
    .popup-actions {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 30px;
        position: relative;
        z-index: 2;
    }
    
    .popup-download-btn {
        background: linear-gradient(135deg, #2ecc71 0%, #1abc9c 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 
            0 6px 20px rgba(46, 204, 113, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
    }
    
    .popup-download-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: 0.5s;
    }
    
    .popup-download-btn:hover::before {
        left: 100%;
    }
    
    .popup-download-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 
            0 12px 30px rgba(46, 204, 113, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    .popup-copy-btn {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 
            0 6px 20px rgba(52, 152, 219, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
    }
    
    .popup-copy-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(255, 255, 255, 0.2),
            transparent
        );
        transition: 0.5s;
    }
    
    .popup-copy-btn:hover::before {
        left: 100%;
    }
    
    .popup-copy-btn:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 
            0 12px 30px rgba(52, 152, 219, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
    
    .upload-status {
        text-align: center;
        margin-top: 15px;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.8);
        position: relative;
        z-index: 2;
        font-weight: 500;
    }
    
    .upload-status.success {
        color: #2ecc71;
        text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        animation: successPulse 2s infinite;
    }
    
    @keyframes successPulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .upload-status.error {
        color: #e74c3c;
        text-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
    }
    
    .upload-progress {
        text-align: center;
        margin-top: 15px;
        font-size: 0.95rem;
        color: #4facfe;
        font-weight: 600;
        position: relative;
        z-index: 2;
        animation: progressText 2s infinite;
    }
    
    @keyframes progressText {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .instructions {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 
            0 8px 32px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
        padding: 30px;
        margin-top: 30px;
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: fadeInUp 1s ease-out 0.7s both;
    }
    
    .instructions h3 {
        color: white;
        margin-bottom: 25px;
        text-align: center;
        font-size: 1.8rem;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .steps {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 25px;
    }
    
    .step {
        flex: 1;
        min-width: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .step:hover {
        transform: translateY(-10px);
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 
            0 15px 35px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    
    .step-number {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        transition: all 0.4s ease;
        position: relative;
        z-index: 1;
    }
    
    .step:hover .step-number {
        transform: scale(1.1) rotate(360deg);
        box-shadow: 0 12px 30px rgba(79, 172, 254, 0.6);
    }
    
    .step-text {
        color: rgba(255, 255, 255, 0.9);
        line-height: 1.6;
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }
    
    footer {
        margin-top: 40px;
        color: rgba(255, 255, 255, 0.7);
        text-align: center;
        font-size: 0.95rem;
        padding: 25px 0;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        width: 100%;
        backdrop-filter: blur(5px);
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.05);
    }
    
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255,255,255,.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    /* Floating particles animation */
    .floating-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }
    
    .particle {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float linear infinite;
    }
    
    @keyframes float {
        0% {
            transform: translateY(100vh) rotate(0deg);
            opacity: 0;
        }
        10% {
            opacity: 0.5;
        }
        90% {
            opacity: 0.5;
        }
        100% {
            transform: translateY(-100px) rotate(360deg);
            opacity: 0;
        }
    }
    
    @media (max-width: 768px) {
        .main-content {
            flex-direction: column;
        }
        
        .camera-section, .collage-section {
            width: 100%;
        }
        
        .popup-actions {
            flex-direction: column;
            gap: 15px;
        }
        
        .popup-download-btn,
        .popup-copy-btn {
            width: 100%;
            justify-content: center;
        }
        
        h1 {
            font-size: 2.2rem;
        }
        
        .template-options {
            gap: 15px;
        }
        
        .template-option {
            width: 60px;
            height: 60px;
        }
    }
</style>
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Photo Collage Capture</h1>
            <p class="subtitle">Take 4 photos with a 5-second gap and create an automatic collage</p>
        </header>
        
        <div class="main-content">
            <section class="camera-section">
                <h2 class="section-title">Camera</h2>
                <div class="camera-container">
                    <div class="camera-placeholder" id="camera-placeholder">
                        Camera access required
                    </div>
                    <video id="camera-feed" autoplay playsinline></video>
                    <div class="countdown-display" id="countdown">5</div>
                </div>
                
                <div class="template-selector">
                    <h4>Select Collage Template</h4>
                    <div class="template-options">
                        <div class="template-option active" data-template="grid" id="template-grid">
                            <div class="template-preview template-1">
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                            </div>
                        </div>
                        <div class="template-option" data-template="featured" id="template-featured">
                            <div class="template-preview template-2">
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                            </div>
                        </div>
                        <div class="template-option" data-template="sidebar" id="template-sidebar">
                            <div class="template-preview template-3">
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                                <div class="preview-cell"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <button id="start-btn">Start Photo Capture</button>
                    
                    <div class="status-indicator">
                        <div class="status-dot" id="status-dot"></div>
                        <span id="status-text">Camera not active</span>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progress</span>
                            <span id="progress-text">0/4 photos</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <div class="photo-counter">
                    <div class="photo-indicator" id="photo-1">1</div>
                    <div class="photo-indicator" id="photo-2">2</div>
                    <div class="photo-indicator" id="photo-3">3</div>
                    <div class="photo-indicator" id="photo-4">4</div>
                </div>
            </section>
            
            <section class="collage-section">
                <h2 class="section-title">Photo Collage</h2>
                <div class="collage-container" id="collage-container">
                    <div class="collage-cell" id="cell-1">
                        <span class="cell-label">Photo 1</span>
                        <img class="collage-img" id="collage-img-1" style="display: none;">
                    </div>
                    <div class="collage-cell" id="cell-2">
                        <span class="cell-label">Photo 2</span>
                        <img class="collage-img" id="collage-img-2" style="display: none;">
                    </div>
                    <div class="collage-cell" id="cell-3">
                        <span class="cell-label">Photo 3</span>
                        <img class="collage-img" id="collage-img-3" style="display: none;">
                    </div>
                    <div class="collage-cell" id="cell-4">
                        <span class="cell-label">Photo 4</span>
                        <img class="collage-img" id="collage-img-4" style="display: none;">
                    </div>
                </div>
                
                <div class="collage-footer">
                    <div class="collage-credit">‚ú® Wizklub Students ‚ú®</div>
                    <div class="created-by">Created with ‚ù§Ô∏è</div>
                </div>
                
                <p id="collage-status" style="text-align: center; margin-top: 15px; color: #7f8c8d;">
                    Collage will appear here after capturing photos
                </p>
            </section>
        </div>
        
        <!-- QR Code Popup Modal -->
        <div class="qr-popup-overlay" id="qr-popup-overlay">
            <div class="qr-popup">
                <button class="popup-close" id="popup-close">√ó</button>
                <h3 class="popup-title">üéâ Your Collage is Ready!</h3>
                <p class="popup-subtitle">Scan this QR code with your phone to download the collage image</p>
                
                <div class="qr-code-container">
                    <div id="qrcode"></div>
                </div>
                
                <div class="popup-instruction">
                    <p><strong>How to use the QR code:</strong></p>
                    <ul>
                        <li>Open your phone's camera app</li>
                        <li>Point camera at the QR code</li>
                        <li>Tap the notification that appears</li>
                        <li>Save the image to your device</li>
                    </ul>
                </div>
                
                <div class="popup-actions">
                    <button class="popup-download-btn" id="popup-download-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download Image
                    </button>
                    <button class="popup-copy-btn" id="popup-copy-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        Copy Link
                    </button>
                </div>
                
                <div class="upload-progress" id="upload-progress"></div>
                <div class="upload-status" id="upload-status"></div>
            </div>
        </div>
        
        <section class="instructions">
            <h3>How to use this photo collage tool</h3>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <p class="step-text">Select a collage template from the options above the capture button.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <p class="step-text">Click "Start Photo Capture" to begin. Allow camera access when prompted.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <p class="step-text">The system will automatically take 4 photos with a 5-second gap between each.</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <p class="step-text">Collage will be automatically uploaded and QR code will appear for download.</p>
                </div>
            </div>
        </section>
        
        <footer>
            <p>Photo Collage Capture System | HTML, CSS & JavaScript | Created by Wizklub Students</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const startBtn = document.getElementById('start-btn');
        const cameraFeed = document.getElementById('camera-feed');
        const cameraPlaceholder = document.getElementById('camera-placeholder');
        const countdownDisplay = document.getElementById('countdown');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');
        const collageContainer = document.getElementById('collage-container');
        const collageCells = [
            document.getElementById('cell-1'),
            document.getElementById('cell-2'),
            document.getElementById('cell-3'),
            document.getElementById('cell-4')
        ];
        const collageImgs = [
            document.getElementById('collage-img-1'),
            document.getElementById('collage-img-2'),
            document.getElementById('collage-img-3'),
            document.getElementById('collage-img-4')
        ];
        const photoIndicators = [
            document.getElementById('photo-1'),
            document.getElementById('photo-2'),
            document.getElementById('photo-3'),
            document.getElementById('photo-4')
        ];
        const collageStatus = document.getElementById('collage-status');
        const qrPopupOverlay = document.getElementById('qr-popup-overlay');
        const popupClose = document.getElementById('popup-close');
        const qrcodeDiv = document.getElementById('qrcode');
        const popupDownloadBtn = document.getElementById('popup-download-btn');
        const popupCopyBtn = document.getElementById('popup-copy-btn');
        const uploadProgress = document.getElementById('upload-progress');
        const uploadStatus = document.getElementById('upload-status');
        
        // Template elements
        const templateOptions = document.querySelectorAll('.template-option');
        
        // State variables
        let stream = null;
        let isCapturing = false;
        let currentPhoto = 0;
        let countdownInterval = null;
        let capturedPhotos = [];
        let selectedTemplate = 'grid';
        let collageDataURL = null;
        let imgbbImageUrl = null;
        let qrCodeInstance = null;
        
        // Your ImgBB API Key (replace with your own)
        // Get free API key from: https://api.imgbb.com/
        const IMGBB_API_KEY = '57592a57bdaa3d7e0e32e11906ffb023'; // Example key - REPLACE WITH YOUR OWN
        
        // Template configurations
        const templates = {
            grid: {
                name: 'Grid Layout',
                css: `
                    grid-template-columns: 1fr 1fr;
                    grid-template-rows: 1fr 1fr;
                `,
                order: [0, 1, 2, 3]
            },
            featured: {
                name: 'Featured Layout',
                css: `
                    grid-template-columns: 1fr 1fr;
                    grid-template-rows: 2fr 1fr 1fr;
                `,
                order: [0, 1, 2, 3]
            },
            sidebar: {
                name: 'Sidebar Layout',
                css: `
                    grid-template-columns: 2fr 1fr 1fr;
                    grid-template-rows: 1fr 1fr;
                `,
                order: [0, 1, 2, 3]
            }
        };
        
        // Initialize camera
        async function initCamera() {
            try {
                // Request camera access
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    } 
                });
                
                // Set camera feed source
                cameraFeed.srcObject = stream;
                cameraFeed.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                
                // Update status
                statusDot.classList.add('active');
                statusText.textContent = 'Camera active - Ready to capture';
                startBtn.disabled = false;
                
                console.log('Camera access granted');
            } catch (error) {
                console.error('Error accessing camera:', error);
                cameraPlaceholder.textContent = 'Unable to access camera. Please check permissions.';
                statusText.textContent = 'Camera access denied';
                startBtn.disabled = true;
            }
        }
        
        // Start the photo capture process
        function startCapture() {
            if (isCapturing) return;
            
            // Reset state
            isCapturing = true;
            currentPhoto = 0;
            capturedPhotos = [];
            collageDataURL = null;
            imgbbImageUrl = null;
            startBtn.disabled = true;
            startBtn.textContent = 'Capturing...';
            statusText.textContent = 'Starting photo capture...';
            uploadStatus.textContent = '';
            uploadProgress.textContent = '';
            
            // Clear previous QR code
            if (qrCodeInstance) {
                qrcodeDiv.innerHTML = '';
                qrCodeInstance = null;
            }
            
            // Reset collage
            collageStatus.textContent = 'Capturing photos...';
            resetCollage();
            resetPhotoIndicators();
            
            // Apply selected template
            applyTemplate(selectedTemplate);
            
            // Start capturing first photo
            captureNextPhoto();
        }
        
        // Apply selected template to collage container
        function applyTemplate(templateName) {
            const template = templates[templateName];
            
            // Apply CSS grid layout
            collageContainer.style.cssText = template.css;
            
            // Reorder cells based on template
            const cells = Array.from(collageContainer.children);
            const reorderedCells = template.order.map(index => cells[index]);
            
            // Clear and reappend in new order
            collageContainer.innerHTML = '';
            reorderedCells.forEach(cell => {
                collageContainer.appendChild(cell);
            });
            
            // Update active template UI
            templateOptions.forEach(option => {
                option.classList.remove('active');
                if (option.dataset.template === templateName) {
                    option.classList.add('active');
                }
            });
            
            console.log(`Applied template: ${template.name}`);
        }
        
        // Capture the next photo in sequence
        function captureNextPhoto() {
            if (currentPhoto >= 4) {
                // All photos captured
                finishCapture();
                return;
            }
            
            // Update UI for current photo
            updateProgress(currentPhoto);
            
            // Start countdown for this photo
            let countdown = 5;
            countdownDisplay.textContent = countdown;
            countdownDisplay.style.display = 'flex';
            
            // Update photo indicator
            photoIndicators[currentPhoto].classList.add('active');
            
            countdownInterval = setInterval(() => {
                countdown--;
                countdownDisplay.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    countdownDisplay.style.display = 'none';
                    
                    // Capture photo
                    capturePhoto();
                    
                    // Move to next photo after a brief pause
                    setTimeout(() => {
                        currentPhoto++;
                        if (currentPhoto < 4) {
                            captureNextPhoto();
                        } else {
                            finishCapture();
                        }
                    }, 500);
                }
            }, 1000);
        }
        
        // Capture a single photo from the camera feed
        function capturePhoto() {
            // Create a canvas to capture the photo
            const canvas = document.createElement('canvas');
            canvas.width = cameraFeed.videoWidth;
            canvas.height = cameraFeed.videoHeight;
            
            // Draw the current video frame to canvas
            const context = canvas.getContext('2d');
            context.drawImage(cameraFeed, 0, 0, canvas.width, canvas.height);
            
            // Add a subtle filter for fun
            context.filter = 'brightness(1.05) contrast(1.05)';
            context.drawImage(canvas, 0, 0);
            
            // Convert to data URL
            const photoData = canvas.toDataURL('image/jpeg');
            
            // Store photo
            capturedPhotos.push(photoData);
            
            // Update collage with captured photo
            updateCollageCell(currentPhoto, photoData);
            
            // Update photo indicator
            photoIndicators[currentPhoto].classList.remove('active');
            photoIndicators[currentPhoto].classList.add('captured');
            
            console.log(`Photo ${currentPhoto + 1} captured`);
        }
        
        // Update collage cell with captured photo
        function updateCollageCell(index, photoData) {
            // Get the cell in current template order
            const cells = Array.from(collageContainer.children);
            const cell = cells[index];
            const img = cell.querySelector('.collage-img');
            
            // Update image source
            img.src = photoData;
            img.style.display = 'block';
            
            // Update cell appearance
            cell.classList.add('filled');
            
            // Hide the label
            cell.querySelector('.cell-label').style.display = 'none';
        }
        
        // Reset collage to initial state
        function resetCollage() {
            const cells = Array.from(collageContainer.children);
            cells.forEach(cell => {
                cell.classList.remove('filled');
                const img = cell.querySelector('.collage-img');
                if (img) {
                    img.style.display = 'none';
                    img.src = '';
                }
                const label = cell.querySelector('.cell-label');
                if (label) {
                    label.style.display = 'block';
                }
            });
        }
        
        // Reset photo indicators
        function resetPhotoIndicators() {
            photoIndicators.forEach(indicator => {
                indicator.classList.remove('active', 'captured');
            });
        }
        
        // Update progress display
        function updateProgress(photoIndex) {
            const progressPercent = ((photoIndex + 1) / 4) * 100;
            progressFill.style.width = `${progressPercent}%`;
            progressText.textContent = `${photoIndex + 1}/4 photos`;
        }
        
        // Load an image and return a promise
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }
        
        // Generate the complete collage as an image
        async function generateCollageImage() {
            try {
                // Create a canvas for the complete collage
                const collageCanvas = document.createElement('canvas');
                const ctx = collageCanvas.getContext('2d');
                
                // Set canvas dimensions (higher quality)
                collageCanvas.width = 1200;
                collageCanvas.height = 1200;
                
                // White background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, collageCanvas.width, collageCanvas.height);
                
                // Draw collage container background
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(50, 50, 1100, 1100);
                
                // Calculate collage area (leaving space for footer)
                const collageArea = {
                    x: 100,
                    y: 100,
                    width: 1000,
                    height: 800
                };
                
                // Get current template layout
                const template = templates[selectedTemplate];
                const cells = Array.from(collageContainer.children);
                
                // Load all images first
                const imagePromises = [];
                const cellImages = [];
                
                for (let i = 0; i < cells.length; i++) {
                    const cell = cells[i];
                    const img = cell.querySelector('.collage-img');
                    if (img && img.src && img.src !== '') {
                        imagePromises.push(
                            loadImage(img.src).then(loadedImg => {
                                cellImages[i] = loadedImg;
                            }).catch(err => {
                                console.error(`Failed to load image ${i}:`, err);
                                cellImages[i] = null;
                            })
                        );
                    } else {
                        cellImages[i] = null;
                    }
                }
                
                // Wait for all images to load
                await Promise.all(imagePromises);
                
                // Draw each collage cell
                for (let i = 0; i < cells.length; i++) {
                    if (!cellImages[i]) continue;
                    
                    // Calculate cell position based on template
                    let cellX, cellY, cellWidth, cellHeight;
                    
                    if (selectedTemplate === 'grid') {
                        const col = i % 2;
                        const row = Math.floor(i / 2);
                        cellWidth = collageArea.width / 2;
                        cellHeight = collageArea.height / 2;
                        cellX = collageArea.x + (col * cellWidth);
                        cellY = collageArea.y + (row * cellHeight);
                    } else if (selectedTemplate === 'featured') {
                        if (i === 0) {
                            // Large top cell
                            cellWidth = collageArea.width;
                            cellHeight = collageArea.height / 2;
                            cellX = collageArea.x;
                            cellY = collageArea.y;
                        } else {
                            // Smaller bottom cells
                            const col = (i - 1) % 2;
                            cellWidth = collageArea.width / 2;
                            cellHeight = collageArea.height / 4;
                            cellX = collageArea.x + (col * cellWidth);
                            cellY = collageArea.y + (collageArea.height / 2) + ((Math.floor((i - 1) / 2)) * cellHeight);
                        }
                    } else if (selectedTemplate === 'sidebar') {
                        if (i === 0) {
                            // Large left cell
                            cellWidth = collageArea.width / 2;
                            cellHeight = collageArea.height;
                            cellX = collageArea.x;
                            cellY = collageArea.y;
                        } else {
                            // Smaller right cells
                            const col = Math.floor((i - 1) / 2) + 1;
                            const row = (i - 1) % 2;
                            cellWidth = collageArea.width / 4;
                            cellHeight = collageArea.height / 2;
                            cellX = collageArea.x + (collageArea.width / 2) + ((col - 1) * cellWidth);
                            cellY = collageArea.y + (row * cellHeight);
                        }
                    }
                    
                    // Draw cell background
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(cellX, cellY, cellWidth, cellHeight);
                    
                    // Draw image with some padding
                    const padding = 5;
                    const imgX = cellX + padding;
                    const imgY = cellY + padding;
                    const imgWidth = cellWidth - (padding * 2);
                    const imgHeight = cellHeight - (padding * 2);
                    
                    ctx.drawImage(cellImages[i], imgX, imgY, imgWidth, imgHeight);
                    
                    // Draw cell border
                    ctx.strokeStyle = '#2ecc71';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(cellX, cellY, cellWidth, cellHeight);
                }
                
                // Draw footer area
                const footerY = collageArea.y + collageArea.height + 50;
                const footerHeight = 150;
                
                // Draw footer background
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(collageArea.x, footerY, collageArea.width, footerHeight);
                
                // Draw footer border
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 4;
                ctx.strokeRect(collageArea.x, footerY, collageArea.width, footerHeight);
                
                // Draw title
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 36px "Segoe UI", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('‚ú® Wizklub Students ‚ú®', collageArea.x + collageArea.width / 2, footerY + 60);
                
                // Draw attribution
                ctx.fillStyle = '#7f8c8d';
                ctx.font = '28px "Segoe UI", sans-serif';
                ctx.fillText('Created with ‚ù§Ô∏è', collageArea.x + collageArea.width / 2, footerY + 110);
                

                
                // Gradient for badge
                const badgeGradient = ctx.createLinearGradient(badgeX, badgeY, badgeX, badgeY + badgeHeight);
                badgeGradient.addColorStop(0, '#FF6B6B');
                badgeGradient.addColorStop(1, '#4ECDC4');
                ctx.fillStyle = badgeGradient;
                ctx.fillRect(badgeX, badgeY - 35, badgeWidth, badgeHeight);
                
                // Badge text
                ctx.fillStyle = 'white';
                ctx.font = 'bold 24px "Segoe UI", sans-serif';
                ctx.fillText(badgeText, collageArea.x + collageArea.width / 2, badgeY);
                
                // Convert to data URL
                collageDataURL = collageCanvas.toDataURL('image/png');
                return collageDataURL;
                
            } catch (error) {
                console.error('Error in generateCollageImage:', error);
                throw error;
            }
        }
        
        // Convert data URL to Blob
        function dataURLtoBlob(dataURL) {
            const arr = dataURL.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            
            while (n--) {
                u8arr[n] = bstr.charCodeAt(n);
            }
            
            return new Blob([u8arr], { type: mime });
        }
        
        // Upload image to ImgBB
        async function uploadToImgBB(imageData) {
            try {
                uploadProgress.textContent = 'Uploading to ImgBB...';
                
                // Convert base64 to blob
                const blob = dataURLtoBlob(imageData);
                
                // Create form data
                const formData = new FormData();
                formData.append('image', blob, 'wizklub-collage.png');
                
                // Upload to ImgBB
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Get the uploaded image URL
                    const imageUrl = data.data.url; // Direct image URL
                    
                    // Store the direct image URL
                    imgbbImageUrl = imageUrl;
                    
                    uploadProgress.textContent = 'Generating QR code...';
                    
                    // Generate QR code using the provided logic
                    generateQRCode(imageUrl);
                    
                    // Show success message
                    uploadStatus.textContent = '‚úÖ Upload successful! Scan QR code to download.';
                    uploadStatus.className = 'upload-status success';
                    uploadProgress.textContent = '';
                    
                    console.log('Image uploaded successfully to ImgBB:', imageUrl);
                    return imageUrl;
                } else {
                    throw new Error(data.error?.message || 'Upload failed');
                }
                
            } catch (error) {
                console.error('Error uploading to ImgBB:', error);
                uploadStatus.textContent = `‚ùå Upload failed: ${error.message}`;
                uploadStatus.className = 'upload-status error';
                uploadProgress.textContent = '';
                
                // Generate QR code with fallback message
                generateQRCode('https://imgbb.com/');
                
                return null;
            }
        }
        
        // Generate QR code using your provided logic
        function generateQRCode(url) {
            // Clear previous QR code
            qrcodeDiv.innerHTML = "";
            
            if (!url || url.trim() === "") {
                url = "https://imgbb.com/"; // Fallback URL
            }
            
            // Generate QR code using the QRCode library
            qrCodeInstance = new QRCode(qrcodeDiv, {
                text: url,
                width: 200,
                height: 200,
                colorDark: "#2c3e50",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            
            console.log('QR Code generated successfully for:', url);
        }
        
        // Show QR code popup
        function showQRPopup() {
            qrPopupOverlay.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        }
        
        // Hide QR code popup
        function hideQRPopup() {
            qrPopupOverlay.classList.remove('active');
            document.body.style.overflow = 'auto'; // Re-enable scrolling
        }
        
        // Copy link to clipboard
        function copyToClipboard() {
            if (!imgbbImageUrl) {
                alert('No link available to copy');
                return;
            }
            
            navigator.clipboard.writeText(imgbbImageUrl).then(() => {
                // Show temporary success message
                const originalText = popupCopyBtn.innerHTML;
                popupCopyBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Copied!
                `;
                popupCopyBtn.style.background = 'linear-gradient(to right, #27ae60, #2ecc71)';
                
                setTimeout(() => {
                    popupCopyBtn.innerHTML = originalText;
                    popupCopyBtn.style.background = 'linear-gradient(to right, #3498db, #2980b9)';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy link. Please copy manually.');
            });
        }
        
        // Download the collage image
        function downloadCollage() {
            if (!imgbbImageUrl) {
                alert('Please wait for the upload to complete');
                return;
            }
            
            const link = document.createElement('a');
            link.download = 'wizklub-collage.png';
            link.href = imgbbImageUrl;
            link.target = '_blank';
            link.click();
            
            // Show download confirmation
            const originalText = popupDownloadBtn.innerHTML;
            popupDownloadBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                Downloaded!
            `;
            popupDownloadBtn.style.background = 'linear-gradient(to right, #27ae60, #2ecc71)';
            
            setTimeout(() => {
                popupDownloadBtn.innerHTML = originalText;
                popupDownloadBtn.style.background = 'linear-gradient(to right, #2ecc71, #1abc9c)';
            }, 2000);
        }
        
        // Finish the capture process
        async function finishCapture() {
            isCapturing = false;
            startBtn.disabled = false;
            startBtn.textContent = 'Start Photo Capture';
            statusText.textContent = 'Capture complete! Generating collage...';
            
            // Generate collage image
            collageStatus.innerHTML = '<span style="color:#3498db;">Generating high-quality collage image...</span>';
            
            try {
                collageDataURL = await generateCollageImage();
                
                // Update UI
                collageStatus.innerHTML = '<span style="color:#2ecc71; font-weight:bold;">üéâ Collage Complete! Auto-uploading...</span>';
                statusText.textContent = 'Uploading to ImgBB...';
                
                // Show QR popup immediately
                showQRPopup();
                uploadProgress.textContent = 'Uploading collage to ImgBB...';
                
                // Automatically upload to ImgBB
                const imageUrl = await uploadToImgBB(collageDataURL);
                
                if (imageUrl) {
                    collageStatus.innerHTML = '<span style="color:#2ecc71; font-weight:bold;">‚úÖ Collage uploaded! Scan QR code to download.</span>';
                    statusText.textContent = 'QR code ready!';
                } else {
                    collageStatus.innerHTML = '<span style="color:#e74c3c;">Upload failed but QR code is ready.</span>';
                    statusText.textContent = 'Upload failed';
                }
                
                console.log('Collage generated and uploaded successfully');
            } catch (error) {
                console.error('Error generating collage:', error);
                collageStatus.innerHTML = '<span style="color:#e74c3c;">Error generating collage. Please try again.</span>';
                statusText.textContent = 'Collage generation failed';
                
                // Show QR popup even if collage generation fails
                setTimeout(() => {
                    showQRPopup();
                    uploadStatus.textContent = '‚ö†Ô∏è Using fallback QR code. Try capturing again.';
                    uploadStatus.className = 'upload-status';
                    generateQRCode('https://imgbb.com/');
                }, 1000);
            }
            
            // Reset progress bar
            setTimeout(() => {
                progressFill.style.width = '0%';
            }, 1000);
        }
        
        // Event Listeners
        startBtn.addEventListener('click', startCapture);
        popupClose.addEventListener('click', hideQRPopup);
        popupDownloadBtn.addEventListener('click', downloadCollage);
        popupCopyBtn.addEventListener('click', copyToClipboard);
        
        // Close popup when clicking outside
        qrPopupOverlay.addEventListener('click', (e) => {
            if (e.target === qrPopupOverlay) {
                hideQRPopup();
            }
        });
        
        // Close popup with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && qrPopupOverlay.classList.contains('active')) {
                hideQRPopup();
            }
        });
        
        // Template selection
        templateOptions.forEach(option => {
            option.addEventListener('click', () => {
                selectedTemplate = option.dataset.template;
                applyTemplate(selectedTemplate);
                
                // Reset collage if photos were already captured
                if (capturedPhotos.length > 0) {
                    // Reapply captured photos to new template
                    capturedPhotos.forEach((photoData, index) => {
                        updateCollageCell(index, photoData);
                    });
                    
                    // Regenerate collage image
                    if (collageDataURL) {
                        generateCollageImage().then(newDataURL => {
                            collageDataURL = newDataURL;
                        }).catch(error => {
                            console.error('Error regenerating collage:', error);
                        });
                    }
                }
            });
        });
        
        // Initialize camera on page load
        window.addEventListener('DOMContentLoaded', initCamera);
        
        // Stop camera when page is unloaded
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
        });
    </script>

    <script>
    // Create floating particles
    function createParticles() {
        const particlesContainer = document.createElement('div');
        particlesContainer.className = 'floating-particles';
        document.body.appendChild(particlesContainer);
        
        for (let i = 0; i < 20; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            const size = Math.random() * 10 + 5;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            
            const startX = Math.random() * 100;
            particle.style.left = `${startX}vw`;
            
            const duration = Math.random() * 20 + 10;
            const delay = Math.random() * 5;
            particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
            
            particlesContainer.appendChild(particle);
        }
    }
    
    // Create particles when page loads
    window.addEventListener('load', createParticles);
</script>
</body>
</html>
